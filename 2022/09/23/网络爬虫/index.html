

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/icon.png">
  <link rel="icon" href="/img/icon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Deng ErPu">
  <meta name="keywords" content="">
  
    <meta name="description" content="网络爬虫入门程序1.创建maven工程 2.导包 1234567891011&lt;dependency&gt;    &lt;groupId&gt;org.apache.httpcomponents&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;httpclient&lt;&#x2F;artifactId&gt;    &lt;version&gt;4.5.2&lt;&#x2F;vers">
<meta property="og:type" content="article">
<meta property="og:title" content="网络爬虫">
<meta property="og:url" content="http://example.com/2022/09/23/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/index.html">
<meta property="og:site_name" content="会写Bug的小邓程序员">
<meta property="og:description" content="网络爬虫入门程序1.创建maven工程 2.导包 1234567891011&lt;dependency&gt;    &lt;groupId&gt;org.apache.httpcomponents&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;httpclient&lt;&#x2F;artifactId&gt;    &lt;version&gt;4.5.2&lt;&#x2F;vers">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/article/crawler.png">
<meta property="article:published_time" content="2022-09-23T12:51:00.000Z">
<meta property="article:modified_time" content="2022-09-23T15:06:18.355Z">
<meta property="article:author" content="Deng ErPu">
<meta property="article:tag" content="网络爬虫">
<meta property="article:tag" content="JAVA">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/img/article/crawler.png">
  
  
  
  <title>网络爬虫 - 会写Bug的小邓程序员</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/mac.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>爱写Bug的小邓程序员</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/bg.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="网络爬虫"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-09-23 20:51" pubdate>
          2022年9月23日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          55k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          457 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">网络爬虫</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="网络爬虫"><a href="#网络爬虫" class="headerlink" title="网络爬虫"></a>网络爬虫</h1><h2 id="入门程序"><a href="#入门程序" class="headerlink" title="入门程序"></a>入门程序</h2><p>1.创建maven工程</p>
<p>2.导包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>httpclient<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.5.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-log4j12<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.30<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>3.配置日志，log4j.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">og4j.rootLogger</span>=<span class="hljs-string">DEBUG,A1</span><br><span class="hljs-attr">log4j.logger.com.ep</span> = <span class="hljs-string">DEBUG</span><br><br><span class="hljs-attr">log4j.appender.A1</span>=<span class="hljs-string">org.apache.log4j.ConsoleAppender</span><br><span class="hljs-attr">log4j.appender.A1.layout</span>=<span class="hljs-string">org.apache.log4j.PatternLayout</span><br><span class="hljs-attr">log4j.appender.A1.layout.ConversionPattern</span>=<span class="hljs-string">%-d&#123;yyyy-MM-dd HH:mm:ss,SSS&#125; [%t] [%c]-[%p] %m%n</span><br></code></pre></td></tr></table></figure>

<p>4.编写程序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep;<br><br><span class="hljs-keyword">import</span> org.apache.http.HttpEntity;<br><span class="hljs-keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;<br><span class="hljs-keyword">import</span> org.apache.http.client.methods.HttpGet;<br><span class="hljs-keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;<br><span class="hljs-keyword">import</span> org.apache.http.impl.client.HttpClients;<br><span class="hljs-keyword">import</span> org.apache.http.util.EntityUtils;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> dep</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CrawlerFirst</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-comment">// 1.创建httpClient对象</span><br>        <span class="hljs-type">CloseableHttpClient</span> <span class="hljs-variable">httpClient</span> <span class="hljs-operator">=</span> HttpClients.createDefault();<br><br>        <span class="hljs-comment">// 2.输入网址，发送get请求创建httpGet对象</span><br>        <span class="hljs-type">HttpGet</span> <span class="hljs-variable">httpGet</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpGet</span>(<span class="hljs-string">&quot;http://www.itcast.cn&quot;</span>);<br><br>        <span class="hljs-comment">// 3. 发起请求，返回形影，使用httpClient对象发起请求</span><br>        <span class="hljs-type">CloseableHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> httpClient.execute(httpGet);<br><br>        <span class="hljs-comment">// 4.解析响应，获取数据</span><br>        <span class="hljs-comment">// 判断状态码是否是200</span><br>        <span class="hljs-keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="hljs-number">200</span>) &#123;<br>            <span class="hljs-type">HttpEntity</span> <span class="hljs-variable">httpEntity</span> <span class="hljs-operator">=</span> response.getEntity();<br>            <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> EntityUtils.toString(httpEntity, <span class="hljs-string">&quot;utf8&quot;</span>);<br>            System.out.println(content);<br><br><br>        &#125;<br>        <br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h2 id="2-HttpClient"><a href="#2-HttpClient" class="headerlink" title="2. HttpClient"></a>2. HttpClient</h2><p>网络爬虫就是用程序帮助我们访问网络上的资源，我们一直以来都是使用HTTP协议访问互联网的网页，网络爬虫需要编写程序，在这里使用同样的HTTP协议访问网页。<br>这里我们使用Java的 HTTP协议客户端 HttpClient这个技术，来实现抓取网页数据。</p>
<h3 id="2-1-Get请求"><a href="#2-1-Get请求" class="headerlink" title="2.1 Get请求"></a>2.1 Get请求</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep;<br><br><span class="hljs-keyword">import</span> org.apache.http.HttpEntity;<br><span class="hljs-keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;<br><span class="hljs-keyword">import</span> org.apache.http.client.methods.HttpGet;<br><span class="hljs-keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;<br><span class="hljs-keyword">import</span> org.apache.http.impl.client.HttpClients;<br><span class="hljs-keyword">import</span> org.apache.http.util.EntityUtils;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> dep</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpClientGetTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// 1.创建httpClient对象</span><br>        <span class="hljs-type">CloseableHttpClient</span> <span class="hljs-variable">httpClient</span> <span class="hljs-operator">=</span> HttpClients.createDefault();<br><br>        <span class="hljs-comment">// 2.输入网址，发送get请求创建httpGet对象</span><br>        <span class="hljs-type">HttpGet</span> <span class="hljs-variable">httpGet</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpGet</span>(<span class="hljs-string">&quot;http://www.itcast.cn&quot;</span>);<br><br>        <span class="hljs-comment">// 3. 发起请求，返回形影，使用httpClient对象发起请求</span><br>        <span class="hljs-type">CloseableHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            response = httpClient.execute(httpGet);<br>            <span class="hljs-comment">// 4.解析响应，获取数据</span><br>            <span class="hljs-comment">// 判断状态码是否是200</span><br>            <span class="hljs-keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="hljs-number">200</span>) &#123;<br>                <span class="hljs-type">HttpEntity</span> <span class="hljs-variable">httpEntity</span> <span class="hljs-operator">=</span> response.getEntity();<br>                <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> EntityUtils.toString(httpEntity, <span class="hljs-string">&quot;utf8&quot;</span>);<br>                System.out.println(content.length());<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>        <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// 关闭资源</span><br>                response.close();<br>                httpClient.close();<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-2-带参数的Get请求"><a href="#2-2-带参数的Get请求" class="headerlink" title="2.2  带参数的Get请求"></a>2.2  带参数的Get请求</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep;<br><br><span class="hljs-keyword">import</span> org.apache.http.HttpEntity;<br><span class="hljs-keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;<br><span class="hljs-keyword">import</span> org.apache.http.client.methods.HttpGet;<br><span class="hljs-keyword">import</span> org.apache.http.client.utils.URIBuilder;<br><span class="hljs-keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;<br><span class="hljs-keyword">import</span> org.apache.http.impl.client.HttpClients;<br><span class="hljs-keyword">import</span> org.apache.http.util.EntityUtils;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.net.URISyntaxException;<br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> dep</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpParameterGet</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> URISyntaxException &#123;<br>        <span class="hljs-type">CloseableHttpClient</span> <span class="hljs-variable">httpClient</span> <span class="hljs-operator">=</span> HttpClients.createDefault();<br><br>        <span class="hljs-comment">// 创建URIBuilder</span><br>        <span class="hljs-type">URIBuilder</span> <span class="hljs-variable">uriBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URIBuilder</span>(<span class="hljs-string">&quot;http://www.baidu.com/s&quot;</span>);<br>        <span class="hljs-comment">// 设置参数 ，多个参数，直接后面.setParameter就行了</span><br>        uriBuilder.setParameter(<span class="hljs-string">&quot;wd&quot;</span>,<span class="hljs-string">&quot;github&quot;</span>);<br><br>        <span class="hljs-comment">// 2.输入网址，发送get请求创建httpGet对象</span><br>        <span class="hljs-type">HttpGet</span> <span class="hljs-variable">httpGet</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpGet</span>(uriBuilder.build());<br><br>        <span class="hljs-comment">// 3. 发起请求，返回形影，使用httpClient对象发起请求</span><br>        <span class="hljs-type">CloseableHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            response = httpClient.execute(httpGet);<br>            <span class="hljs-comment">// 4.解析响应，获取数据</span><br>            <span class="hljs-comment">// 判断状态码是否是200</span><br>            <span class="hljs-keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="hljs-number">200</span>) &#123;<br>                <span class="hljs-type">HttpEntity</span> <span class="hljs-variable">httpEntity</span> <span class="hljs-operator">=</span> response.getEntity();<br>                <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> EntityUtils.toString(httpEntity, <span class="hljs-string">&quot;utf8&quot;</span>);<br>                System.out.println(content.length());<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>        <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// 关闭资源</span><br>                response.close();<br>                httpClient.close();<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="2-3-Post请求"><a href="#2-3-Post请求" class="headerlink" title="2.3 Post请求"></a>2.3 Post请求</h3><blockquote>
<p> 同Get请求，唯一就是httpGet变为httpPost</p>
</blockquote>
<p>2.4 带参数的Post请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep;<br><br><span class="hljs-keyword">import</span> org.apache.http.HttpEntity;<br><span class="hljs-keyword">import</span> org.apache.http.NameValuePair;<br><span class="hljs-keyword">import</span> org.apache.http.client.entity.UrlEncodedFormEntity;<br><span class="hljs-keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;<br><span class="hljs-keyword">import</span> org.apache.http.client.methods.HttpGet;<br><span class="hljs-keyword">import</span> org.apache.http.client.methods.HttpPost;<br><span class="hljs-keyword">import</span> org.apache.http.client.utils.URIBuilder;<br><span class="hljs-keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;<br><span class="hljs-keyword">import</span> org.apache.http.impl.client.HttpClients;<br><span class="hljs-keyword">import</span> org.apache.http.message.BasicNameValuePair;<br><span class="hljs-keyword">import</span> org.apache.http.util.EntityUtils;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.UnsupportedEncodingException;<br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> dep</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpParameterPost</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> UnsupportedEncodingException &#123;<br>        <span class="hljs-type">CloseableHttpClient</span> <span class="hljs-variable">httpClient</span> <span class="hljs-operator">=</span> HttpClients.createDefault();<br><br>       <span class="hljs-comment">// 创建httpPost对象，设置url访问地址</span><br>        <span class="hljs-type">HttpPost</span> <span class="hljs-variable">httpPost</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpPost</span>(<span class="hljs-string">&quot;http://www.baidu.com/s&quot;</span>);<br><br>        <span class="hljs-comment">// 声明List集合，封装表单中的参数</span><br>        ArrayList&lt;NameValuePair&gt; params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;NameValuePair&gt;();<br>        params.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicNameValuePair</span>(<span class="hljs-string">&quot;wd&quot;</span>,<span class="hljs-string">&quot;github&quot;</span>));<br><br>        <span class="hljs-comment">// 创建表单的Entity对象，第一个参数就是封装好的表单数据，第二个参数就是编码</span><br>        <span class="hljs-type">UrlEncodedFormEntity</span> <span class="hljs-variable">formEntity</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UrlEncodedFormEntity</span>(params, <span class="hljs-string">&quot;utf8&quot;</span>);<br><br>        <span class="hljs-comment">// 设置表单的Entity对象到Post请求中</span><br>        httpPost.setEntity(formEntity);<br>        <br>        <span class="hljs-comment">// 3. 发起请求，返回形影，使用httpClient对象发起请求</span><br>        <span class="hljs-type">CloseableHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            response = httpClient.execute(httpPost);<br>            <span class="hljs-comment">// 4.解析响应，获取数据</span><br>            <span class="hljs-comment">// 判断状态码是否是200</span><br>            <span class="hljs-keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="hljs-number">200</span>) &#123;<br>                <span class="hljs-type">HttpEntity</span> <span class="hljs-variable">httpEntity</span> <span class="hljs-operator">=</span> response.getEntity();<br>                <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> EntityUtils.toString(httpEntity, <span class="hljs-string">&quot;utf8&quot;</span>);<br>                System.out.println(content);<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>        <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// 关闭资源</span><br>                response.close();<br>                httpClient.close();<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="2-4-连接池"><a href="#2-4-连接池" class="headerlink" title="2.4 连接池"></a>2.4 连接池</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep;<br><br><span class="hljs-keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;<br><span class="hljs-keyword">import</span> org.apache.http.client.methods.HttpGet;<br><span class="hljs-keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;<br><span class="hljs-keyword">import</span> org.apache.http.impl.client.HttpClients;<br><span class="hljs-keyword">import</span> org.apache.http.impl.conn.PoolingHttpClientConnectionManager;<br><span class="hljs-keyword">import</span> org.apache.http.util.EntityUtils;<br><br><span class="hljs-keyword">import</span> javax.xml.ws.http.HTTPBinding;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> dep</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpClientPoolTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// 创建连接池管理器</span><br>        <span class="hljs-type">PoolingHttpClientConnectionManager</span> <span class="hljs-variable">cm</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PoolingHttpClientConnectionManager</span>();<br><br>        <span class="hljs-comment">// 设置最大连接数</span><br>        cm.setMaxTotal(<span class="hljs-number">100</span>);<br><br>        <span class="hljs-comment">// 设置每个主机的最大连接数</span><br>        cm.setDefaultMaxPerRoute(<span class="hljs-number">10</span>);<br><br>        <span class="hljs-comment">// 使用连接池管理器发送请求</span><br>        doGet(cm);<br>        doGet(cm);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(PoolingHttpClientConnectionManager cm)</span>&#123;<br>        <span class="hljs-comment">// 不是每次创建新的HttpClient，而是从连接池中获取HttpClient对象</span><br>        <span class="hljs-type">CloseableHttpClient</span> <span class="hljs-variable">httpClient</span> <span class="hljs-operator">=</span> HttpClients.custom().setConnectionManager(cm).build();<br><br>        <span class="hljs-type">HttpGet</span> <span class="hljs-variable">httpGet</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpGet</span>(<span class="hljs-string">&quot;http://www.itcast.cn&quot;</span>);<br><br>        <span class="hljs-type">CloseableHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>             response = httpClient.execute(httpGet);<br>             <span class="hljs-keyword">if</span>(response.getStatusLine().getStatusCode() == <span class="hljs-number">200</span>) &#123;<br>                 <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> EntityUtils.toString(response.getEntity(),<span class="hljs-string">&quot;utf8&quot;</span>);<br>                 System.out.println(content);<br>             &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">if</span> (response != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    response.close();<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>                &#125;<br>                <span class="hljs-comment">// 不能关闭HttpCient，有连接池管理HttpClient</span><br>            &#125;<br>        &#125;<br><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="2-5-配置请求信息"><a href="#2-5-配置请求信息" class="headerlink" title="2.5 配置请求信息"></a>2.5 配置请求信息</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 配置请求信息</span><br><span class="hljs-type">RequestConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> RequestConfig.custom().setConnectionRequestTimeout(<span class="hljs-number">1000</span>) <span class="hljs-comment">// 创建连接的最长时间，单位是毫秒</span><br>        .setConnectionRequestTimeout(<span class="hljs-number">500</span>) <span class="hljs-comment">// 设置获取连接的最长时间，单位是毫秒</span><br>        .setSocketTimeout(<span class="hljs-number">10</span> * <span class="hljs-number">1000</span>) <span class="hljs-comment">// 设置数据传输的最长时间，单位是毫秒</span><br>        .build();<br><br><span class="hljs-comment">// 给请求设置请求信息</span><br>httpGet.setConfig(config);<br></code></pre></td></tr></table></figure>

<p>完整代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep;<br><br><span class="hljs-keyword">import</span> org.apache.http.HttpEntity;<br><span class="hljs-keyword">import</span> org.apache.http.client.config.RequestConfig;<br><span class="hljs-keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;<br><span class="hljs-keyword">import</span> org.apache.http.client.methods.HttpGet;<br><span class="hljs-keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;<br><span class="hljs-keyword">import</span> org.apache.http.impl.client.HttpClients;<br><span class="hljs-keyword">import</span> org.apache.http.util.EntityUtils;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> dep</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpConfigTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// 1.创建httpClient对象</span><br>        <span class="hljs-type">CloseableHttpClient</span> <span class="hljs-variable">httpClient</span> <span class="hljs-operator">=</span> HttpClients.createDefault();<br><br>        <span class="hljs-comment">// 2.输入网址，发送get请求创建httpGet对象</span><br>        <span class="hljs-type">HttpGet</span> <span class="hljs-variable">httpGet</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpGet</span>(<span class="hljs-string">&quot;http://www.itcast.cn&quot;</span>);<br>        <span class="hljs-comment">// 配置请求信息</span><br>        <span class="hljs-type">RequestConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> RequestConfig.custom().setConnectionRequestTimeout(<span class="hljs-number">1000</span>) <span class="hljs-comment">// 创建连接的最长时间，单位是毫秒</span><br>                .setConnectionRequestTimeout(<span class="hljs-number">500</span>) <span class="hljs-comment">// 设置获取连接的最长时间，单位是毫秒</span><br>                .setSocketTimeout(<span class="hljs-number">10</span> * <span class="hljs-number">1000</span>) <span class="hljs-comment">// 设置数据传输的最长时间，单位是毫秒</span><br>                .build();<br><br>        <span class="hljs-comment">// 给请求设置请求信息</span><br>        httpGet.setConfig(config);<br><br>        <span class="hljs-comment">// 3. 发起请求，返回形影，使用httpClient对象发起请求</span><br>        <span class="hljs-type">CloseableHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            response = httpClient.execute(httpGet);<br>            <span class="hljs-comment">// 4.解析响应，获取数据</span><br>            <span class="hljs-comment">// 判断状态码是否是200</span><br>            <span class="hljs-keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="hljs-number">200</span>) &#123;<br>                <span class="hljs-type">HttpEntity</span> <span class="hljs-variable">httpEntity</span> <span class="hljs-operator">=</span> response.getEntity();<br>                <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> EntityUtils.toString(httpEntity, <span class="hljs-string">&quot;utf8&quot;</span>);<br>                System.out.println(content.length());<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>        <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// 关闭资源</span><br>                response.close();<br>                httpClient.close();<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="3-Jsoup"><a href="#3-Jsoup" class="headerlink" title="3.Jsoup"></a>3.Jsoup</h2><p>我们抓取到页面之后，还需要对页面进行解析。可以使用字符串处理工具解析页面，也可以使用正则表达式，但是这些方法都会带来很大的开发成本，所以我们需要使用一款专门解析html页面的技术。</p>
<h3 id="3-1-jsoup介绍"><a href="#3-1-jsoup介绍" class="headerlink" title="3.1. jsoup介绍"></a>3.1. jsoup介绍</h3><p>jsoup是一款Java 的 HTML解析器，可直接解析某个URL地址、HTML文木内容。它提供了一套非常省力的 API，可通过DOM，CSS 以及类似于jQuery 的操作方法来取出和操作数据。</p>
<p>jsoup的主要功能如下: </p>
<ol>
<li>从一个URL，文件或字符串中解析HTML;</li>
<li>使用DOM或CSS选择器来查找、取出数据;</li>
<li>可操作 HTML元素、属性、文本;</li>
</ol>
<p>导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.jsoup<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jsoup<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.14.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/commons-io/commons-io --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.11.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-lang3<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.12.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="3-2-jsoup解析"><a href="#3-2-jsoup解析" class="headerlink" title="3.2 jsoup解析"></a>3.2 jsoup解析</h3><h4 id="3-2-1-解析URL"><a href="#3-2-1-解析URL" class="headerlink" title="3.2.1 解析URL"></a>3.2.1 解析URL</h4><p>Jsoup可以直接输入url，它会发起请求并获取数据，封装为Document对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span>  <span class="hljs-title function_">parseUrl</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-comment">// 解析url地址</span><br>    <span class="hljs-type">Document</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> Jsoup.parse(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-string">&quot;https://www.baidu.com&quot;</span>),<span class="hljs-number">3000</span>);<br>    <span class="hljs-comment">// 获取title的内容</span><br>    <span class="hljs-type">Element</span> <span class="hljs-variable">title</span> <span class="hljs-operator">=</span> document.getElementsByTag(<span class="hljs-string">&quot;title&quot;</span>).first();<br>    System.out.println(title.text());<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p> 虽然使用Jsoup可以替代HttpClient直接发起请求解析数据，但是往往不会这样用，因为实际的开发过程中，需要使用到多线程，连接池，代理等等方式，而 jsoup 对这些的支持并不是很好，所以我们一般把 jsoup仅仅作为 Html解析工具使用。</p>
</blockquote>
<h4 id="3-2-2-解析字符串"><a href="#3-2-2-解析字符串" class="headerlink" title="3.2.2 解析字符串"></a>3.2.2 解析字符串</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parseString</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-comment">// 使用工具类读取文件，获取字符串</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> FileUtils.readFileToString(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;F:\\@前端\\html\\example1.html&quot;</span>),<span class="hljs-string">&quot;gbk&quot;</span>);<br><br>    <span class="hljs-comment">// 解析字符串</span><br>    <span class="hljs-type">Document</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> Jsoup.parse(content);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">title</span> <span class="hljs-operator">=</span> document.getElementsByTag(<span class="hljs-string">&quot;title&quot;</span>).first().text();<br>    System.out.println(title);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="3-2-3-解析文件"><a href="#3-2-3-解析文件" class="headerlink" title="3.2.3 解析文件"></a>3.2.3 解析文件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parseFile</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-type">Document</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> Jsoup.parse(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;F:\\\\@前端\\\\html\\\\example1.html&quot;</span>), <span class="hljs-string">&quot;gbk&quot;</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">title</span> <span class="hljs-operator">=</span> document.getElementsByTag(<span class="hljs-string">&quot;title&quot;</span>).first().text();<br>    System.out.println(title);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="3-2-4-元素获取"><a href="#3-2-4-元素获取" class="headerlink" title="3.2.4 元素获取"></a>3.2.4 元素获取</h4><p>dom元素获取:</p>
<ol>
<li>根据id查询元素getElementByld</li>
<li>根据标签获取元素getElementsByTag</li>
<li>根据class获取元素 getElementsByClass</li>
<li>根据属性获取元素getElementsByAttribute</li>
</ol>
<p>Selector选择器获取:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">document.select()<br></code></pre></td></tr></table></figure>

<p>​	<code>tagname</code>:通过标签查找元素，比如: span</p>
<p>​	<code>#id</code>:通过ID查找元素，比如: #city_bj</p>
<p>​	<code>.class</code>:通过class名称查找元素，比如: .class_av</p>
<p>​	<code>[attribute]</code>:利用属性查找元素，比如: [abc]。</p>
<p>​	<code>[attr=value]</code>:利用属性值来查找元素，比如: [class&#x3D;s_name]</p>
<h4 id="3-2-5-Selector选择器组合使用。"><a href="#3-2-5-Selector选择器组合使用。" class="headerlink" title="3.2.5. Selector选择器组合使用。"></a>3.2.5. Selector选择器组合使用。</h4><p><code>el#id</code>:元素+ID，比如:h3city_bjl<br><code>el.class</code>:元素+class，比如:li.class_av</p>
<p><code>el[attr]</code>:元素+属性名，比如:span[abc]任意组合:比如: span[abc].s_namev<br><code>ancestor child</code>:查找某个元素下子元素，比如: .city_con li  查找”city_con”下的所有li</p>
<p><code>parent &gt; child</code>:查找某个父元素下的直接子元素，比如:.city_con &gt;ul&gt;li   查找city_con第一级（直接子元素）的ul，再找所有ul下的第一级</p>
<p><code>parent &gt;*</code>:查找某个父元素下所有直接子元素。</p>
<h2 id="4-爬虫案例"><a href="#4-爬虫案例" class="headerlink" title="4.爬虫案例"></a>4.爬虫案例</h2><p>学习了HttpClient和 Jsoup，就掌握了如何抓取数据和如何解析数据,接下来,我们做一个小练习，把京东的手机数据抓取下来。主要目的是HttpCliet和 Jsoup的学习。</p>
<ol>
<li><p>创建数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE `jd_item`(<br>	`id` bigint (10) NOT NULL AUTO_INCREMENT COMMENT &#x27;主键id&#x27;,<br>	`spu` bigint (15) DEFAULT NULL COMMENT &#x27;商品集合id&#x27;,<br>	`sku` bigint (15) DEFAULT NULL COMMENT &#x27;商品最小品类单元id&#x27;,<br>	`title` varchar(100) DEFAULT NULL COMMENT &#x27;商品标题&#x27;,<br>	`price` bigint (10) DEFAULT NULL COMMENT &#x27;商品价格&#x27;,<br>	`pic` varchar (200) DEFAULT NULL COMMENT &#x27;商品图片&#x27;,<br>	`ur1` varchar (200) DEFAULT NULL COMMENT &#x27;商品详情地址&#x27;,<br>	`created` datetime DEFAULT NULL COMMENT &#x27;创建时间&#x27;,<br>	`updated` datetime DEFAULT NULL COMMENT &#x27;更新时间&#x27;,<br>	PRIMARY KEY ( `id` ),<br>KEY `sku` (`sku`) USING BTREE<br>)ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=&#x27;京东商品表&#x27;;<br></code></pre></td></tr></table></figure></li>
</ol>
<p>创建maven工程，导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs xml">  <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.2.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--    springMVC--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--    SpringData Jpa--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--    mysql连接包--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- HttpClient --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>httpclient<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-lang3<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.jsoup<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jsoup<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.14.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>application.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment">#DB configuration:</span><br><span class="hljs-attr">spring.datasource.driverClassName</span>=<span class="hljs-string">com.mysql.jdbc.Driver</span><br><span class="hljs-attr">spring.datasource.url</span>=<span class="hljs-string">jdbc:mysql://127.0.0.1:3306/crawler</span><br><span class="hljs-attr">spring.datasource.username</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">spring.datasource.password</span>=<span class="hljs-string">root</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">#JPA Configuration:</span><br><span class="hljs-attr">spring.jpa.database</span>=<span class="hljs-string">MySQL</span><br><span class="hljs-attr">spring.jpa.show-sql</span>=<span class="hljs-string">true</span><br></code></pre></td></tr></table></figure>

<p>编写实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep.jd.pojo;<br><br><span class="hljs-keyword">import</span> javax.persistence.*;<br><span class="hljs-keyword">import</span> java.util.Date;<br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> dep</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-meta">@Entity</span><br><span class="hljs-meta">@Table(name = &quot;jd_item&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span> &#123;<br><br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span><br>    <span class="hljs-keyword">private</span> Long id;<br>    <span class="hljs-comment">// 标准产品单位（商品集合）</span><br>    <span class="hljs-keyword">private</span> Long spu;<br>    <span class="hljs-comment">// 库存量单位（最小品类单元）</span><br>    <span class="hljs-keyword">private</span> Long sku;<br>    <span class="hljs-comment">// 商品标题</span><br>    <span class="hljs-keyword">private</span> String title;<br>    <span class="hljs-comment">// 商品价格</span><br>    <span class="hljs-keyword">private</span> Double price;<br>    <span class="hljs-comment">/// 商品图片</span><br>    <span class="hljs-keyword">private</span> String pic;<br>    <span class="hljs-comment">// 创建时间</span><br>    <span class="hljs-keyword">private</span> Date created;<br>    <span class="hljs-keyword">private</span> Date updated;<br><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getSpu</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> spu;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSpu</span><span class="hljs-params">(Long spu)</span> &#123;<br>        <span class="hljs-built_in">this</span>.spu = spu;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getSku</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> sku;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSku</span><span class="hljs-params">(Long sku)</span> &#123;<br>        <span class="hljs-built_in">this</span>.sku = sku;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getTitle</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> title;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTitle</span><span class="hljs-params">(String title)</span> &#123;<br>        <span class="hljs-built_in">this</span>.title = title;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Double <span class="hljs-title function_">getPrice</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> price;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPrice</span><span class="hljs-params">(Double price)</span> &#123;<br>        <span class="hljs-built_in">this</span>.price = price;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPic</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> pic;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPic</span><span class="hljs-params">(String pic)</span> &#123;<br>        <span class="hljs-built_in">this</span>.pic = pic;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Date <span class="hljs-title function_">getCreated</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> created;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCreated</span><span class="hljs-params">(Date created)</span> &#123;<br>        <span class="hljs-built_in">this</span>.created = created;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Date <span class="hljs-title function_">getUpdated</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> updated;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUpdated</span><span class="hljs-params">(Date updated)</span> &#123;<br>        <span class="hljs-built_in">this</span>.updated = updated;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Item&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;id=&quot;</span> + id +<br>                <span class="hljs-string">&quot;, spu=&quot;</span> + spu +<br>                <span class="hljs-string">&quot;, sku=&quot;</span> + sku +<br>                <span class="hljs-string">&quot;, title=&#x27;&quot;</span> + title + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, price=&quot;</span> + price +<br>                <span class="hljs-string">&quot;, pic=&#x27;&quot;</span> + pic + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, created=&quot;</span> + created +<br>                <span class="hljs-string">&quot;, updated=&quot;</span> + updated +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>





<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220919204002580.png" srcset="/img/loading.gif" lazyload alt="image-20220919204002580"></p>
<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220919204246097.png" srcset="/img/loading.gif" lazyload alt="image-20220919204246097"></p>
<p>编写dao</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep.jd.dao;<br><br><span class="hljs-keyword">import</span> com.ep.jd.pojo.Item;<br><span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Repository;<br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> dep</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ItemDao</span>  <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaRepository</span>&lt;Item, Long&gt; &#123;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>编写Service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep.jd.service;<br><br><span class="hljs-keyword">import</span> com.ep.jd.pojo.Item;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> dep</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ItemService</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 保存商品信息</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> item</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(Item item)</span>;<br><br>    <span class="hljs-comment">/***</span><br><span class="hljs-comment">     * 查询所有商品</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> item</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> List&lt;Item&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">(Item item)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>编写Service实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep.jd.service.impl;<br><br><span class="hljs-keyword">import</span> com.ep.jd.dao.ItemDao;<br><span class="hljs-keyword">import</span> com.ep.jd.pojo.Item;<br><span class="hljs-keyword">import</span> com.ep.jd.service.ItemService;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.data.domain.Example;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> dep</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ItemServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ItemService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ItemDao itemDao;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(Item item)</span> &#123;<br>        itemDao.save(item);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;Item&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">(Item item)</span> &#123;<br>        <span class="hljs-comment">// 声明查询条件</span><br>        Example&lt;Item&gt; example = Example.of(item);<br>        <span class="hljs-comment">// 根据查询条件进行查询数据</span><br>        List&lt;Item&gt; list = itemDao.findAll(example);<br>        <span class="hljs-keyword">return</span> list;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>编写引导类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep.jd;<br><br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><span class="hljs-keyword">import</span> org.springframework.scheduling.annotation.EnableScheduling;<br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> dep</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-comment">// 使用定时任务，需要先开启定时任务，需要加注解</span><br><span class="hljs-meta">@EnableScheduling</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Application</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(Application.class, args);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p><strong>封装HttpClient</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep.jd.util;<br><br><span class="hljs-keyword">import</span> org.apache.http.client.HttpClient;<br><span class="hljs-keyword">import</span> org.apache.http.client.config.RequestConfig;<br><span class="hljs-keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;<br><span class="hljs-keyword">import</span> org.apache.http.client.methods.HttpGet;<br><span class="hljs-keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;<br><span class="hljs-keyword">import</span> org.apache.http.impl.client.HttpClients;<br><span class="hljs-keyword">import</span> org.apache.http.impl.conn.PoolingHttpClientConnectionManager;<br><span class="hljs-keyword">import</span> org.apache.http.util.EntityUtils;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.UUID;<br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> dep</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpUtils</span> &#123;<br>    <span class="hljs-keyword">private</span> PoolingHttpClientConnectionManager cm;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">HttpUtils</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.cm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PoolingHttpClientConnectionManager</span>();<br>        <span class="hljs-comment">// 设置最大连接数</span><br>        cm.setMaxTotal(<span class="hljs-number">100</span>);<br><br>        <span class="hljs-comment">// 设置每个主机的最大连接数</span><br>        cm.setDefaultMaxPerRoute(<span class="hljs-number">10</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据请求地址下载页面数据</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">doGetHtml</span><span class="hljs-params">(String url)</span>&#123;<br>        <span class="hljs-comment">// 获取HttpClient对象</span><br>        <span class="hljs-type">CloseableHttpClient</span> <span class="hljs-variable">httpClient</span> <span class="hljs-operator">=</span> HttpClients.custom().setConnectionManager(<span class="hljs-built_in">this</span>.cm).build();<br>        <span class="hljs-comment">// 创建httpGet请求对象，设置url地址</span><br>        <span class="hljs-type">HttpGet</span> <span class="hljs-variable">httpGet</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpGet</span>(url);<br>        <span class="hljs-comment">// 设置请求信息</span><br>        httpGet.setConfig(<span class="hljs-built_in">this</span>.getConfig());<br><br>        <span class="hljs-type">CloseableHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 使用HttpClient发送请求，获取响应</span><br>            response = httpClient.execute(httpGet);<br>            <span class="hljs-comment">// 解析响应，返回结果</span><br>            <span class="hljs-keyword">if</span>(response.getStatusLine().getStatusCode() == <span class="hljs-number">200</span>) &#123;<br>                <span class="hljs-comment">// 判断响应体Entity是否不为空，如果不为空就可以使用EntityUtils</span><br>                <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> EntityUtils.toString(response.getEntity(), <span class="hljs-string">&quot;utf8&quot;</span>);<br>                <span class="hljs-keyword">return</span> content;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">if</span> (response != <span class="hljs-literal">null</span>) &#123;<br>                    response.close();<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">// 返回空串</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br><br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据请求地址下载图片</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> url</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">doGetImage</span><span class="hljs-params">(String url)</span>&#123;<br>        <span class="hljs-comment">// 获取HttpClient对象</span><br>        <span class="hljs-type">CloseableHttpClient</span> <span class="hljs-variable">httpClient</span> <span class="hljs-operator">=</span> HttpClients.custom().setConnectionManager(<span class="hljs-built_in">this</span>.cm).build();<br>        <span class="hljs-comment">// 创建httpGet请求对象，设置url地址</span><br>        <span class="hljs-type">HttpGet</span> <span class="hljs-variable">httpGet</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpGet</span>(url);<br>        <span class="hljs-comment">// 设置请求信息</span><br>        httpGet.setConfig(<span class="hljs-built_in">this</span>.getConfig());<br><br>        httpGet.setHeader(<span class="hljs-string">&quot;User-Agent&quot;</span>,<span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36&quot;</span>);<br>        httpGet.setHeader(<span class="hljs-string">&quot;sec-ch-ua&quot;</span>,<span class="hljs-string">&quot;.Not/A)Brand\&quot;;v=\&quot;99\&quot;, \&quot;Google Chrome\&quot;;v=\&quot;103\&quot;, \&quot;Chromium\&quot;;v=\&quot;103&quot;</span>);<br><br>        <span class="hljs-type">CloseableHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">outputStream</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 使用HttpClient发送请求，获取响应</span><br>            response = httpClient.execute(httpGet);<br>            <span class="hljs-comment">// 解析响应，返回结果</span><br>            <span class="hljs-keyword">if</span>(response.getStatusLine().getStatusCode() == <span class="hljs-number">200</span>) &#123;<br>                <span class="hljs-comment">// 下载图片</span><br>                <span class="hljs-comment">// 获取图片的后缀</span><br>                <span class="hljs-type">String</span> <span class="hljs-variable">extName</span> <span class="hljs-operator">=</span> url.substring(url.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>));<br><br>                <span class="hljs-comment">//创建图片名，重命名图片</span><br>                <span class="hljs-type">String</span> <span class="hljs-variable">picName</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString() + extName;<br>                <span class="hljs-comment">//下载图片</span><br>                <span class="hljs-comment">//声明OutPutStream</span><br>                outputStream = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;E:\\images:\\&quot;</span> + picName));<br>                response.getEntity().writeTo(outputStream);<br><br>                <span class="hljs-comment">// 返回图片名称</span><br>                <span class="hljs-keyword">return</span> picName;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">if</span> (response != <span class="hljs-literal">null</span>) &#123;<br>                    response.close();<br>                &#125;<br>                <span class="hljs-keyword">if</span> (outputStream != <span class="hljs-literal">null</span>) &#123;<br>                    outputStream.close();<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">// 返回空串</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> RequestConfig <span class="hljs-title function_">getConfig</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 配置请求信息</span><br>        <span class="hljs-type">RequestConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> RequestConfig.custom().setConnectionRequestTimeout(<span class="hljs-number">1000</span>) <span class="hljs-comment">// 创建连接的最长时间，单位是毫秒</span><br>                .setConnectionRequestTimeout(<span class="hljs-number">500</span>) <span class="hljs-comment">// 设置获取连接的最长时间，单位是毫秒</span><br>                .setSocketTimeout(<span class="hljs-number">10</span> * <span class="hljs-number">1000</span>) <span class="hljs-comment">// 设置数据传输的最长时间，单位是毫秒</span><br>                .build();<br>        <span class="hljs-keyword">return</span> config;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>



<p>编写定时任务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep.jd.task;<br><br><span class="hljs-keyword">import</span> com.ep.jd.pojo.Item;<br><span class="hljs-keyword">import</span> com.ep.jd.service.ItemService;<br><span class="hljs-keyword">import</span> com.ep.jd.util.HttpUtils;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;<br><span class="hljs-keyword">import</span> org.jsoup.Jsoup;<br><span class="hljs-keyword">import</span> org.jsoup.nodes.Document;<br><span class="hljs-keyword">import</span> org.jsoup.nodes.Element;<br><span class="hljs-keyword">import</span> org.jsoup.select.Elements;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.scheduling.annotation.Scheduled;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> java.util.Date;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> dep</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ItemTask</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> HttpUtils httpUtils;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ItemService itemService;<br><br>    <span class="hljs-comment">// 当下载任务完成后，间隔多长时间进行下一次的任务</span><br>    <span class="hljs-meta">@Scheduled(fixedDelay = 100*1000)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">itemTask</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 声明要解析的初始地址</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https://search.jd.com/Search?keyword=%E6%89%8B%E6%9C%BA&amp;wq=%E6%89%8B%E6%9C%BA&amp;pvid=21eadb733591426dbccf55c911ef732d&amp;s=57&amp;click=0&amp;page=&quot;</span>;<br>        <span class="hljs-comment">// 按照页面对手机的搜索结果进行遍历解析</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">10</span>; i += <span class="hljs-number">2</span>) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">html</span> <span class="hljs-operator">=</span> httpUtils.doGetHtml(url + i);<br><br>            System.out.println(html.length());<br>            <span class="hljs-comment">// 解析页面，获取商品数据存储</span><br>           <span class="hljs-comment">// this.parse(html);</span><br>            System.out.println(html);<br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;手机数据抓取完毕&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 解析页面。获取商品数据并存储</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parse</span><span class="hljs-params">(String html)</span>&#123;<br>        <span class="hljs-comment">// 解析html获取Document</span><br>        <span class="hljs-type">Document</span> <span class="hljs-variable">doc</span> <span class="hljs-operator">=</span> Jsoup.parse(html);<br><br>        <span class="hljs-comment">// 获取spu信息</span><br>        <span class="hljs-type">Elements</span> <span class="hljs-variable">spuEles</span> <span class="hljs-operator">=</span> doc.select(<span class="hljs-string">&quot;div#J_goodsList &gt; ul &gt; li&quot;</span>);<br>        <span class="hljs-keyword">for</span> (Element spuEle: spuEles) &#123;<br>            <span class="hljs-comment">// 获取spu</span><br>            <span class="hljs-type">long</span> <span class="hljs-variable">spu</span> <span class="hljs-operator">=</span> Long.parseLong(spuEle.attr(<span class="hljs-string">&quot;data-spu&quot;</span>));<br><br>            <span class="hljs-comment">// 获取sku信息</span><br>            <span class="hljs-type">Elements</span> <span class="hljs-variable">skuEles</span> <span class="hljs-operator">=</span> spuEle.select(<span class="hljs-string">&quot;li.ps-item&quot;</span>);<br>            <span class="hljs-keyword">for</span> (Element skuEle: skuEles) &#123;<br>                <span class="hljs-type">long</span> <span class="hljs-variable">sku</span> <span class="hljs-operator">=</span> Long.parseLong(skuEle.select(<span class="hljs-string">&quot;[data-sku]&quot;</span>).attr(<span class="hljs-string">&quot;data-sku&quot;</span>));<br>                <span class="hljs-comment">// 根据sku查询商品数据</span><br>                <span class="hljs-type">Item</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Item</span>();<br>                item.setSku(sku);<br>                List&lt;Item&gt; list = itemService.findAll(item);<br>                <span class="hljs-keyword">if</span>(list.size() &gt; <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-comment">// 如果商品存在，就进行下一个循环，该商品不保存，因为已存在</span><br>                    <span class="hljs-keyword">continue</span>;<br>                &#125;<br>                <span class="hljs-comment">// 设置商品的spu</span><br>                item.setSpu(spu);<br>                <span class="hljs-comment">// 设置商品的详情url</span><br>                <span class="hljs-type">String</span> <span class="hljs-variable">imgUrl</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https://item.jd.com/&quot;</span>+sku+<span class="hljs-string">&quot;.html&quot;</span>;<br>                item.setUrl(imgUrl);<br><br>                <span class="hljs-comment">// 获取商品的图片</span><br>                <span class="hljs-type">String</span> <span class="hljs-variable">picUrl</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https:&quot;</span> + skuEle.select(<span class="hljs-string">&quot;img[data-sku]&quot;</span>).first().attr(<span class="hljs-string">&quot;data-lazy-img&quot;</span>);<br>                picUrl = picUrl.replace(<span class="hljs-string">&quot;(/n7/)|(/n9/)&quot;</span>, <span class="hljs-string">&quot;/n1/&quot;</span>);<br>                <span class="hljs-type">String</span> <span class="hljs-variable">picName</span> <span class="hljs-operator">=</span> httpUtils.doGetImage(picUrl);<br>                item.setPic(picName);<br><br>                <span class="hljs-comment">// 获取商品价格（从详情页面拿商品的价格）</span><br>                <span class="hljs-type">String</span> <span class="hljs-variable">itemDetailHtml</span> <span class="hljs-operator">=</span> httpUtils.doGetHtml(item.getUrl());<br>                <span class="hljs-type">Document</span> <span class="hljs-variable">itemDetialDoc</span> <span class="hljs-operator">=</span> Jsoup.parse(itemDetailHtml);<br>                <span class="hljs-type">String</span> <span class="hljs-variable">price</span> <span class="hljs-operator">=</span> itemDetialDoc.select(<span class="hljs-string">&quot;span.p-price .price&quot;</span>).text();<br>                item.setPrice(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Double</span>(price));<br><br>                <span class="hljs-comment">// 获取商品的标题</span><br>                <span class="hljs-type">String</span> <span class="hljs-variable">title</span> <span class="hljs-operator">=</span> itemDetialDoc.select(<span class="hljs-string">&quot;div.sku-name&quot;</span>).text();<br>                item.setTitle(title);<br><br><br>                item.setCreated(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>                item.setUpdated(item.getCreated());<br><br>                <span class="hljs-comment">// 保存商品数据到数据库</span><br>                itemService.save(item);<br><br>                System.out.println(item);<br>            &#125;<br><br>        &#125;<br><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>



<h2 id="5-WebMagic介绍"><a href="#5-WebMagic介绍" class="headerlink" title="5.WebMagic介绍"></a>5.WebMagic介绍</h2><p>​	昨天完成了爬虫的入门的学习，是一个最基本的爬虫案例，今天我们要学习一款爬虫框架的使用就是 WebMagic。其底层用到了我们上一天课程所使用的HttpClient和 Jsoup，让我们能够更方便的开发爬虫。<br>​	webMagic项目代码分为核心和扩展两部分。核心部分(webmagic-core)是一个精简的、模块化的爬虫实现，而扩展部分则包括一些便利的、实用性的功能。<br>​	webMagic的设计目标是尽量的模块化，并体现爬虫的功能特点。这部分提供非常简单、灵活的API，在基本不改变开发模式的情况下，编写一个爬虫。<br>​	扩展部分(webmagic-extension)提供一些便捷的功能，例如注解模式编写爬虫等。同时内置了一些常用的组件，便于爬虫开发。</p>
<h3 id="5-1-架构介绍"><a href="#5-1-架构介绍" class="headerlink" title="5.1 架构介绍"></a>5.1 架构介绍</h3><p>WebMagic的结构分为Downloader、PageProcessor、Scheduler、Pipeline四大组件,并由Spider将它们彼此组织起来。这四大组件对应爬虫生命周期中的下载、处理、管理和持久化等功能。WebMagic的设计参考了Scapy，但是实现方式更Java化一些。<br>而spider则将这几个组件组织起来，让它们可以互相交互，流程化的执行,可以认为Spider是一个大的容器，它也是 WebMagic逻辑的核心。</p>
<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220921215642290.png" srcset="/img/loading.gif" lazyload alt="image-20220921215642290"></p>
<h4 id="5-1-1-WebMagic的四个组件"><a href="#5-1-1-WebMagic的四个组件" class="headerlink" title="5.1.1. WebMagic的四个组件"></a>5.1.1. WebMagic的四个组件</h4><h5 id="1-Downloaderv"><a href="#1-Downloaderv" class="headerlink" title="1.Downloaderv"></a>1.Downloaderv</h5><p>Downloader负责从互联网上下载页面，以便后续处理。WebMagic 默认使用了Apache HttpClient 作为下载工具。</p>
<h5 id="2-PageProcessor"><a href="#2-PageProcessor" class="headerlink" title="2.PageProcessor"></a>2.PageProcessor</h5><p>PageProcessor负责解析页面，抽取有用信息，以及发现新的链接。WebMagic使用Jsoup作为HTML解析工具，并基于其开发了解析XPath 的工具Xsoup。<br>在这四个组件中，PageProcessor对于每个站点每个页面都不一样，是需要使用者定制的部分。</p>
<h5 id="3-Scheduler"><a href="#3-Scheduler" class="headerlink" title="3.Scheduler"></a>3.Scheduler</h5><p>Scheduler负责管理待抓取的URL，以及一些去重的工作。WebMagic默认提供了JDK的内存队列来管理URL，并用集合来进行去重。也支持使用Redis进行分布式管理。</p>
<h5 id="4-Pipelinew"><a href="#4-Pipelinew" class="headerlink" title="4.Pipelinew"></a>4.Pipelinew</h5><p>Pipeline负责抽取结果的处理，包括计算、持久化到文件、数据库等。WebMagic默认提供了“输出到控制台”和“保存到文件”两种结果处理方案。<br>Pipeline定义了结果保存的方式，如果你要保存到指定数据库，则需要编写对应的 Pipeline。对于一类需求一般只需编写一个Pipeline。</p>
<h4 id="5-1-2-用于数据流转的对象"><a href="#5-1-2-用于数据流转的对象" class="headerlink" title="5.1.2. 用于数据流转的对象"></a>5.1.2. 用于数据流转的对象</h4><ol>
<li>Request</li>
</ol>
<p>Request是对URL地址的一层封装，一个Request对应一个URL地址。</p>
<p>它是PageProcessor与Downloader交互的载体，也是PageProcessor控制Downloader唯一方式。</p>
<p>除了URL本身外，它还包含一个Key-Value结构的字段extra。你可以在extra中保存一些特殊的属性，然后在其他地方读取，以完成不同的功能。例如附加上一个页面的一些信息等。</p>
<ol start="2">
<li>Page</li>
</ol>
<p>Page代表了从Downloader下载到的一个页面——可能是HTML，也可能是JSON或者其他文本格式的内容。</p>
<p>Page是WebMagic抽取过程的核心对象，它提供一些方法可供抽取、结果保存等。</p>
<ol start="3">
<li>ResultItems</li>
</ol>
<p>ResultItems相当于一个Map，它保存PageProcessor处理的结果，供Pipeline使用。它的API与Map很类似，值得注意的是它有一个字段skip，若设置为true，则不应被Pipeline处理。</p>
<h3 id="5-2-入门案例"><a href="#5-2-入门案例" class="headerlink" title="5.2. 入门案例"></a>5.2. 入门案例</h3><h4 id="5-2-1-加入依赖"><a href="#5-2-1-加入依赖" class="headerlink" title="5.2.1. 加入依赖"></a>5.2.1. 加入依赖</h4><p>创建Maven工程，并加入以下依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/us.codecraft/webmagic-core --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>us.codecraft<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>webmagic-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.7.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/us.codecraft/webmagic-extension --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>us.codecraft<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>webmagic-extension<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.7.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h4 id="5-2-2-加入配置文件"><a href="#5-2-2-加入配置文件" class="headerlink" title="5.2.2. 加入配置文件"></a>5.2.2. 加入配置文件</h4><p>WebMagic使用slf4j-log4j12作为slf4j的实现。</p>
<p>添加log4j.properties配置文件</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">log4j.rootLogger</span>=<span class="hljs-string">INFO,A1 </span><br><span class="hljs-attr">log4j.appender.A1</span>=<span class="hljs-string">org.apache.log4j.ConsoleAppender</span><br><span class="hljs-attr">log4j.appender.A1.layout</span>=<span class="hljs-string">org.apache.log4j.PatternLayout</span><br><span class="hljs-attr">log4j.appender.A1.layout.ConversionPattern</span>=<span class="hljs-string">%-d&#123;yyyy-MM-dd HH:mm:ss,SSS&#125; [%t] [%c]-[%p] %m%n</span><br></code></pre></td></tr></table></figure>

<h4 id="5-2-3-编写程序"><a href="#5-2-3-编写程序" class="headerlink" title="5.2.3 编写程序"></a>5.2.3 编写程序</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep;<br><br><span class="hljs-keyword">import</span> org.jetbrains.annotations.NotNull;<br><span class="hljs-keyword">import</span> us.codecraft.webmagic.Page;<br><span class="hljs-keyword">import</span> us.codecraft.webmagic.Site;<br><span class="hljs-keyword">import</span> us.codecraft.webmagic.Spider;<br><span class="hljs-keyword">import</span> us.codecraft.webmagic.processor.PageProcessor;<br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> dep</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JobProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PageProcessor</span> &#123;<br><br>    <span class="hljs-comment">// 解析页面</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(Page page)</span> &#123;<br>        <span class="hljs-comment">// 解析返回数据page,并且把解析的结果放到ResultItems中</span><br>        page.putField(<span class="hljs-string">&quot;title&quot;</span>, page.getHtml().css(<span class="hljs-string">&quot;.nav-item a&quot;</span>).all());<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Site</span> <span class="hljs-variable">site</span> <span class="hljs-operator">=</span> Site.me();<br>    <span class="hljs-keyword">public</span> Site <span class="hljs-title function_">getSite</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> site;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        Spider.create(<span class="hljs-keyword">new</span> <span class="hljs-title class_">JobProcessor</span>())<br>                <span class="hljs-comment">//初始访问url地址</span><br>                .addUrl(<span class="hljs-string">&quot;https://getp.gitee.io/docs/&quot;</span>)<br>                .run(); <span class="hljs-comment">// 执行爬虫</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="5-3-WebMagic功能"><a href="#5-3-WebMagic功能" class="headerlink" title="5.3. WebMagic功能"></a>5.3. WebMagic功能</h3><h4 id="实现PageProcessor"><a href="#实现PageProcessor" class="headerlink" title="实现PageProcessor"></a>实现PageProcessor</h4><p><strong>抽取元素Selectable</strong></p>
<p>WebMagic里主要使用了三种抽取技术：XPath、正则表达式和CSS选择器。另外，对于JSON格式的内容，可使用JsonPath进行解析。</p>
<ol>
<li>XPath</li>
</ol>
<p>以上是获取属性class&#x3D;mt的div标签，里面的h1标签的内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">page.getHtml().xpath(<span class="hljs-string">&quot;//div[@class=mt]/h1/text()&quot;</span>)<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>CSS选择器</li>
</ol>
<p>CSS选择器是与XPath类似的语言。在上一次的课程中，我们已经学习过了Jsoup的选择器，它比XPath写起来要简单一些，但是如果写复杂一点的抽取规则，就相对要麻烦一点。</p>
<p>div.mt&gt;h1表示class为mt的div标签下的直接子元素h1标签</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">page.getHtml().css(<span class="hljs-string">&quot;div#news_div &gt; ul &gt; li:nth-child(1) a&quot;</span>).toString()<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>正则表达式</li>
</ol>
<p>正则表达式则是一种通用的文本抽取语言。在这里一般用于获取url地址。</p>
<p><strong>抽取元素API</strong></p>
<p>Selectable相关的抽取元素链式API是WebMagic的一个核心功能。使用Selectable接口，可以直接完成页面元素的链式抽取，也无需去关心抽取的细节。</p>
<p>在刚才的例子中可以看到，page.getHtml()返回的是一个Html对象，它实现了Selectable接口。这个接口包含的方法分为两类：抽取部分和获取结果部分。</p>
<table>
<thead>
<tr>
<th><strong>方法</strong></th>
<th><strong>说明</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td>xpath(String xpath)</td>
<td>使用XPath选择</td>
<td>html.xpath(“&#x2F;&#x2F;div[@class&#x3D;’title’]”)</td>
</tr>
<tr>
<td>$(String selector)</td>
<td>使用Css选择器选择</td>
<td>html.$(“div.title”)</td>
</tr>
<tr>
<td>$(String selector,String attr)</td>
<td>使用Css选择器选择</td>
<td>html.$(“div.title”,”text”)</td>
</tr>
<tr>
<td>css(String selector)</td>
<td>功能同$()，使用Css选择器选择</td>
<td>html.css(“div.title”)</td>
</tr>
<tr>
<td>links()</td>
<td>选择所有链接</td>
<td>html.links()</td>
</tr>
<tr>
<td>regex(String regex)</td>
<td>使用正则表达式抽取</td>
<td>html.regex(“(.*?)&quot;)</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 解析返回数据page,并且把解析的结果放到ResultItems中</span><br> <span class="hljs-comment">// css</span><br> page.putField(<span class="hljs-string">&quot;title&quot;</span>, page.getHtml().css(<span class="hljs-string">&quot;.nav-item a&quot;</span>).all());<br><br> <span class="hljs-comment">// XPath</span><br> page.putField(<span class="hljs-string">&quot;div2&quot;</span>,page.getHtml().xpath(<span class="hljs-string">&quot;//div[@class=nav-item]/a&quot;</span>));<br><br> <span class="hljs-comment">// 正则表达式</span><br> page.putField(<span class="hljs-string">&quot;div3&quot;</span>,page.getHtml().css(<span class="hljs-string">&quot;.nav-item a&quot;</span>).regex(<span class="hljs-string">&quot;.*首页.*&quot;</span>).all());<br></code></pre></td></tr></table></figure>

<p><strong>获取结果API</strong></p>
<p>当链式调用结束时，我们一般都想要拿到一个字符串类型的结果。这时候就需要用到获取结果的API了。</p>
<p>我们知道，一条抽取规则，无论是XPath、CSS选择器或者正则表达式，总有可能抽取到多条元素。WebMagic对这些进行了统一，可以通过不同的API获取到一个或者多个元素。</p>
<table>
<thead>
<tr>
<th><strong>方法</strong></th>
<th><strong>说明</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td>get()</td>
<td>返回一条String类型的结果</td>
<td>String link&#x3D; html.links().get()</td>
</tr>
<tr>
<td>toString()</td>
<td>同get()，返回一条String类型的结果</td>
<td>String link&#x3D; html.links().toString()</td>
</tr>
<tr>
<td>all()</td>
<td>返回所有抽取结果</td>
<td>List links&#x3D; html.links().all()</td>
</tr>
</tbody></table>
<p>当有多条数据的时候，使用get()和toString()都是获取第一个url地址。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">page.putField(<span class="hljs-string">&quot;div3&quot;</span>,page.getHtml().css(<span class="hljs-string">&quot;.nav-item a&quot;</span>).regex(<span class="hljs-string">&quot;.*首页.*&quot;</span>).all());<br><span class="hljs-comment">// 处理结果API</span><br>page.putField(<span class="hljs-string">&quot;div4&quot;</span>,page.getHtml().css(<span class="hljs-string">&quot;.nav-item a&quot;</span>).regex(<span class="hljs-string">&quot;.*首页.*&quot;</span>).get());<br>page.putField(<span class="hljs-string">&quot;div5&quot;</span>,page.getHtml().css(<span class="hljs-string">&quot;.nav-item a&quot;</span>).regex(<span class="hljs-string">&quot;.*首页.*&quot;</span>).toString());<br></code></pre></td></tr></table></figure>

<h4 id="获取链接"><a href="#获取链接" class="headerlink" title="获取链接"></a>获取链接</h4><p>有了处理页面的逻辑，我们的爬虫就接近完工了，但是现在还有一个问题：一个站点的页面是很多的，一开始我们不可能全部列举出来，于是如何发现后续的链接，是一个爬虫不可缺少的一部分。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 获取链接</span><br>page.addTargetRequests(page.getHtml().css(<span class="hljs-string">&quot;.nav-item a&quot;</span>).links().regex(<span class="hljs-string">&quot;.*about.*&quot;</span>).all());<br>page.putField(<span class="hljs-string">&quot;url&quot;</span>,page.getHtml().css(<span class="hljs-string">&quot;title&quot;</span>).toString());<br></code></pre></td></tr></table></figure>

<h4 id="使用Pipeline保存结果"><a href="#使用Pipeline保存结果" class="headerlink" title="使用Pipeline保存结果"></a>使用Pipeline保存结果</h4><p>WebMagic用于保存结果的组件叫做Pipeline。我们现在通过“控制台输出结果”这件事也是通过一个内置的Pipeline完成的，它叫做ConsolePipeline。</p>
<p>那么，我现在想要把结果用保存到文件中，怎么做呢？只将Pipeline的实现换成”FilePipeline”就可以了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    Spider.create(<span class="hljs-keyword">new</span> <span class="hljs-title class_">JobProcessor</span>())<br>            <span class="hljs-comment">//初始访问url地址</span><br>            .addUrl(<span class="hljs-string">&quot;https://getp.gitee.io/docs/&quot;</span>)<br>            <span class="hljs-comment">// 保存到文件</span><br>            .addPipeline(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FilePipeline</span>(<span class="hljs-string">&quot;C:\\Users\\Administrator.SC-201902031211\\Desktop\\result&quot;</span>))<br>            .thread(<span class="hljs-number">5</span>) <span class="hljs-comment">// 设置有5个线程处理</span><br>            .run(); <span class="hljs-comment">// 执行爬虫</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="爬虫的配置、启动和终止"><a href="#爬虫的配置、启动和终止" class="headerlink" title="爬虫的配置、启动和终止"></a>爬虫的配置、启动和终止</h4><h5 id="Spider"><a href="#Spider" class="headerlink" title="Spider"></a>Spider</h5><p>Spider是爬虫启动的入口。在启动爬虫之前，我们需要使用一个PageProcessor创建一个Spider对象，然后使用run()进行启动。</p>
<p>同时Spider的其他组件（Downloader、Scheduler、Pipeline）都可以通过set方法来进行设置。</p>
<table>
<thead>
<tr>
<th><strong>方法</strong></th>
<th><strong>说明</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td>create(PageProcessor)</td>
<td>创建Spider</td>
<td>Spider.create(new GithubRepoProcessor())</td>
</tr>
<tr>
<td>addUrl(String…)</td>
<td>添加初始的URL</td>
<td>spider .addUrl(“<a target="_blank" rel="noopener" href="http://webmagic.io/docs/&quot;">http://webmagic.io/docs/&quot;</a>)</td>
</tr>
<tr>
<td>thread(n)</td>
<td>开启n个线程</td>
<td>spider.thread(5)</td>
</tr>
<tr>
<td>run()</td>
<td>启动，会阻塞当前线程执行</td>
<td>spider.run()</td>
</tr>
<tr>
<td>start()&#x2F;runAsync()</td>
<td>异步启动，当前线程继续执行</td>
<td>spider.start()</td>
</tr>
<tr>
<td>stop()</td>
<td>停止爬虫</td>
<td>spider.stop()</td>
</tr>
<tr>
<td>addPipeline(Pipeline)</td>
<td>添加一个Pipeline，一个Spider可以有多个Pipeline</td>
<td>spider .addPipeline(new ConsolePipeline())</td>
</tr>
<tr>
<td>setScheduler(Scheduler)</td>
<td>设置Scheduler，一个Spider只能有个一个Scheduler</td>
<td>spider.setScheduler(new RedisScheduler())</td>
</tr>
<tr>
<td>setDownloader(Downloader)</td>
<td>设置Downloader，一个Spider只能有个一个Downloader</td>
<td>spider .setDownloader(new SeleniumDownloader())</td>
</tr>
<tr>
<td>get(String)</td>
<td>同步调用，并直接取得结果</td>
<td>ResultItems result &#x3D; spider.get(“<a target="_blank" rel="noopener" href="http://webmagic.io/docs/&quot;">http://webmagic.io/docs/&quot;</a>)</td>
</tr>
<tr>
<td>getAll(String…)</td>
<td>同步调用，并直接取得一堆结果</td>
<td>List<ResultItems> results &#x3D; spider .getAll(“<a target="_blank" rel="noopener" href="http://webmagic.io/docs/&quot;">http://webmagic.io/docs/&quot;</a>, “<a target="_blank" rel="noopener" href="http://webmagic.io/xxx&quot;">http://webmagic.io/xxx&quot;</a>)</td>
</tr>
</tbody></table>
<h5 id="爬虫配置Site"><a href="#爬虫配置Site" class="headerlink" title="爬虫配置Site"></a>爬虫配置Site</h5><p>Site.me()可以对爬虫进行一些配置配置，包括编码、抓取间隔、超时时间、重试次数等。在这里我们先简单设置一下：重试次数为3次，抓取间隔为一秒</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">Site</span> <span class="hljs-variable">site</span> <span class="hljs-operator">=</span> Site.me()<br>          .setCharset(<span class="hljs-string">&quot;utf8&quot;</span>) <span class="hljs-comment">// 编码</span><br>          .setSleepTime(<span class="hljs-number">1</span>) <span class="hljs-comment">// 抓取时间间隔</span><br>          .setTimeOut(<span class="hljs-number">10</span>*<span class="hljs-number">1000</span>) <span class="hljs-comment">// 超时时间</span><br>          .setRetrySleepTime(<span class="hljs-number">3000</span>) <span class="hljs-comment">// 重试时间</span><br>          .setRetryTimes(<span class="hljs-number">3</span>); <span class="hljs-comment">// 重试次数</span><br></code></pre></td></tr></table></figure>

<p>站点本身的一些配置信息，例如编码、HTTP头、超时时间、重试策略等、代理等，都可以通过设置Site对象来进行配置。</p>
<table>
<thead>
<tr>
<th><strong>方法</strong></th>
<th><strong>说明</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td>setCharset(String)</td>
<td>设置编码</td>
<td>site.setCharset(“utf-8”)</td>
</tr>
<tr>
<td>setUserAgent(String)</td>
<td>设置UserAgent</td>
<td>site.setUserAgent(“Spider”)</td>
</tr>
<tr>
<td>setTimeOut(int)</td>
<td>设置超时时间，单位是毫秒</td>
<td>site.setTimeOut(3000)</td>
</tr>
<tr>
<td>setRetryTimes(int)</td>
<td>设置重试次数</td>
<td>site.setRetryTimes(3)</td>
</tr>
<tr>
<td>setCycleRetryTimes(int)</td>
<td>设置循环重试次数</td>
<td>site.setCycleRetryTimes(3)</td>
</tr>
<tr>
<td>addCookie(String,String)</td>
<td>添加一条cookie</td>
<td>site.addCookie(“dotcomt_user”,”code4craft”)</td>
</tr>
<tr>
<td>setDomain(String)</td>
<td>设置域名，需设置域名后，addCookie才可生效</td>
<td>site.setDomain(“github.com”)</td>
</tr>
<tr>
<td>addHeader(String,String)</td>
<td>添加一条addHeader</td>
<td>site.addHeader(“Referer”,”<a target="_blank" rel="noopener" href="https://github.com/">https://github.com</a>“)</td>
</tr>
<tr>
<td>setHttpProxy(HttpHost)</td>
<td>设置Http代理</td>
<td>site.setHttpProxy(new HttpHost(“127.0.0.1”,8080))</td>
</tr>
</tbody></table>
<h2 id="6-爬虫分类"><a href="#6-爬虫分类" class="headerlink" title="6. 爬虫分类"></a>6. 爬虫分类</h2><p>网络爬虫按照系统结构和实现技术，大致可以分为以下几种类型：通用网络爬虫、聚焦网络爬虫、增量式网络爬虫、深层网络爬虫。 实际的网络爬虫系统通常是几种爬虫技术相结合实现的</p>
<h4 id="6-1-通用网络爬虫"><a href="#6-1-通用网络爬虫" class="headerlink" title="6.1. 通用网络爬虫"></a>6.1. 通用网络爬虫</h4><p>通用网络爬虫又称全网爬虫（Scalable Web Crawler），爬行对象从一些种子 URL 扩充到整个 Web，主要为门户站点搜索引擎和大型 Web 服务提供商采集数据。 </p>
<p>这类网络爬虫的爬行范围和数量巨大，对于爬行速度和存储空间要求较高，对于爬行页面的顺序要求相对较低，同时由于待刷新的页面太多，通常采用并行工作方式，但需要较长时间才能刷新一次页面。 </p>
<p>简单的说就是互联网上抓取所有数据。</p>
<h4 id="6-2-聚焦网络爬虫"><a href="#6-2-聚焦网络爬虫" class="headerlink" title="6.2. 聚焦网络爬虫"></a>6.2. 聚焦网络爬虫</h4><p>聚焦网络爬虫（Focused Crawler），又称主题网络爬虫（Topical Crawler），是指选择性地爬行那些与预先定义好的主题相关页面的网络爬虫。</p>
<p>和通用网络爬虫相比，聚焦爬虫只需要爬行与主题相关的页面，极大地节省了硬件和网络资源，保存的页面也由于数量少而更新快，还可以很好地满足一些特定人群对特定领域信息的需求 。</p>
<p>简单的说就是互联网上只抓取某一种数据。</p>
<h4 id="6-3-增量式网络爬虫"><a href="#6-3-增量式网络爬虫" class="headerlink" title="6.3. 增量式网络爬虫"></a>6.3. 增量式网络爬虫</h4><p>增量式网络爬虫（Incremental Web Crawler）是 指 对 已 下 载 网 页 采 取 增量式更新和只爬行新产生的或者已经发生变化网页的爬虫，它能够在一定程度上保证所爬行的页面是尽可能新的页面。</p>
<p>和周期性爬行和刷新页面的网络爬虫相比，增量式爬虫只会在需要的时候爬行新产生或发生更新的页面 ，并不重新下载没有发生变化的页面，可有效减少数据下载量，及时更新已爬行的网页，减小时间和空间上的耗费，但是增加了爬行算法的复杂度和实现难度。</p>
<p>简单的说就是互联网上只抓取刚刚更新的数据。</p>
<h4 id="6-4-Deep-Web-爬虫"><a href="#6-4-Deep-Web-爬虫" class="headerlink" title="6.4. Deep Web 爬虫"></a>6.4. Deep Web 爬虫</h4><p>Web 页面按存在方式可以分为表层网页（Surface Web）和深层网页（Deep Web，也称 Invisible Web Pages 或 Hidden Web）。 </p>
<p>表层网页是指传统搜索引擎可以索引的页面，以超链接可以到达的静态网页为主构成的 Web 页面。</p>
<p>Deep Web 是那些大部分内容不能通过静态链接获取的、隐藏在搜索表单后的，只有用户提交一些关键词才能获得的 Web 页面。</p>
<h2 id="7-案例开发分析"><a href="#7-案例开发分析" class="headerlink" title="7.案例开发分析"></a>7.案例开发分析</h2><p>我们已经学完了WebMagic的基本使用方法，现在准备使用WebMagic实现爬取数据的功能。这里是一个比较完整的实现。在这里我们实现的是聚焦网络爬虫，只爬取招聘的相关数据。</p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/Hpeacheng/article/details/124276335?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166394131416782391881335%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall%255Fv2.%2522%257D&amp;request_id=166394131416782391881335&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all_v2~first_rank_ecpm_v1~rank_v31_ecpm-3-124276335-null-null.142%5Ev50%5Econtrol_1,201%5Ev3%5Eadd_ask&amp;utm_term=java%E9%BB%91%E9%A9%AC%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E8%B5%84%E6%96%99&amp;spm=1018.2226.3001.4187">https://blog.csdn.net/Hpeacheng/article/details/124276335?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166394131416782391881335%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall%255Fv2.%2522%257D&amp;request_id=166394131416782391881335&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all_v2~first_rank_ecpm_v1~rank_v31_ecpm-3-124276335-null-null.142^v50^control_1,201^v3^add_ask&amp;utm_term=java%E9%BB%91%E9%A9%AC%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E8%B5%84%E6%96%99&amp;spm=1018.2226.3001.4187</a></p>
<h3 id="7-1业务分析"><a href="#7-1业务分析" class="headerlink" title="7.1业务分析"></a>7.1业务分析</h3><p>今天要实现的是爬取<a target="_blank" rel="noopener" href="https://www.51job.com/%E4%B8%8A%E7%9A%84%E6%8B%9B%E8%81%98%E4%BF%A1%E6%81%AF%E3%80%82%E5%8F%AA%E7%88%AC%E5%8F%96%E2%80%9C%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%BD%AF%E4%BB%B6%E2%80%9D%E5%92%8C%E2%80%9C%E4%BA%92%E8%81%94%E7%BD%91%E7%94%B5%E5%AD%90%E5%95%86%E5%8A%A1%E2%80%9D%E4%B8%A4%E4%B8%AA%E8%A1%8C%E4%B8%9A%E7%9A%84%E4%BF%A1%E6%81%AF%E3%80%82">https://www.51job.com/上的招聘信息。只爬取“计算机软件”和“互联网电子商务”两个行业的信息。</a></p>
<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220922212305799.png" srcset="/img/loading.gif" lazyload alt="image-20220922212305799"></p>
<p>点击职位详情页，我们分析发现详情页还有一些数据需要抓取：</p>
<p>职位、公司名称、工作地点、薪资、发布时间、职位信息、公司联系方式、公司信息</p>
<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220922212403343.png" srcset="/img/loading.gif" lazyload alt="image-20220922212403343"></p>
<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220922212423930.png" srcset="/img/loading.gif" lazyload alt="image-20220922212423930"></p>
<h3 id="7-2-数据库表"><a href="#7-2-数据库表" class="headerlink" title="7.2 数据库表"></a>7.2 数据库表</h3><p>根据以上信息，设计数据库表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE `job_info` (<br>  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#x27;主键id&#x27;,<br>  `company_name` varchar(100) DEFAULT NULL COMMENT &#x27;公司名称&#x27;,<br>  `company_addr` varchar(200) DEFAULT NULL COMMENT &#x27;公司联系方式&#x27;,<br>  `company_info` text COMMENT &#x27;公司信息&#x27;,<br>  `job_name` varchar(100) DEFAULT NULL COMMENT &#x27;职位名称&#x27;,<br>  `job_addr` varchar(50) DEFAULT NULL COMMENT &#x27;工作地点&#x27;,<br>  `job_info` text COMMENT &#x27;职位信息&#x27;,<br>	`salary_min` int(10) DEFAULT NULL COMMENT &#x27;薪资范围，最小&#x27;,<br>  `salary_max` int(10) DEFAULT NULL COMMENT &#x27;薪资范围，最大&#x27;,<br>  `url` varchar(150) DEFAULT NULL COMMENT &#x27;招聘信息详情页&#x27;,<br>  `time` varchar(10) DEFAULT NULL COMMENT &#x27;职位最近发布时间&#x27;,<br>  PRIMARY KEY (`id`)<br>) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT=&#x27;招聘信息&#x27;;<br></code></pre></td></tr></table></figure>

<h3 id="7-3实现流程"><a href="#7-3实现流程" class="headerlink" title="7.3实现流程"></a>7.3实现流程</h3><p>我们需要解析职位列表页，获取职位的详情页，再解析页面获取数据。</p>
<p>获取url地址的流程如下</p>
<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220922213440441.png" srcset="/img/loading.gif" lazyload alt="image-20220922213440441"></p>
<p>但是在这里有个问题：在解析页面的时候，很可能会解析出相同的url地址(例如商品标题和商品图片超链接，而且url一样)，如果不进行处理，同样的url会解析处理多次，浪费资源。所以我们需要有一个url去重的功能</p>
<h4 id="Scheduler组件"><a href="#Scheduler组件" class="headerlink" title="Scheduler组件"></a>Scheduler组件</h4><p>WebMagic提供了Scheduler可以帮助我们解决以上问题。</p>
<p>Scheduler是WebMagic中进行URL管理的组件。一般来说，Scheduler包括两个作用：</p>
<ul>
<li><p>对待抓取的URL队列进行管理。</p>
</li>
<li><p>对已抓取的URL进行去重。</p>
</li>
</ul>
<p>WebMagic内置了几个常用的Scheduler。如果你只是在本地执行规模比较小的爬虫，那么基本无需定制Scheduler，但是了解一下已经提供的几个Scheduler还是有意义的。</p>
<table>
<thead>
<tr>
<th>类</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>DuplicateRemovedScheduler</td>
<td>抽象基类，提供一些模板方法</td>
<td>继承它可以实现自己的功能</td>
</tr>
<tr>
<td>QueueScheduler</td>
<td>使用内存队列保存待抓取URL</td>
<td></td>
</tr>
<tr>
<td>PriorityScheduler</td>
<td>使用带有优先级的内存队列保存待抓取URL</td>
<td>耗费内存较QueueScheduler更大，但是当设置了request.priority之后，只能使用PriorityScheduler才可使优先级生效</td>
</tr>
<tr>
<td>FileCacheQueueScheduler</td>
<td>使用文件保存抓取URL，可以在关闭程序并下次启动时，从之前抓取到的URL继续抓取</td>
<td>需指定路径，会建立.urls.txt和.cursor.txt两个文件</td>
</tr>
<tr>
<td>RedisScheduler</td>
<td>使用Redis保存抓取队列，可进行多台机器同时合作抓取</td>
<td>需要安装并启动redis</td>
</tr>
</tbody></table>
<p>去重部分被单独抽象成了一个接口：DuplicateRemover，从而可以为同一个Scheduler选择不同的去重方式，以适应不同的需要，目前提供了两种去重方式。</p>
<table>
<thead>
<tr>
<th>类</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>HashSetDuplicateRemover</td>
<td>使用HashSet来进行去重，占用内存较大</td>
</tr>
<tr>
<td>BloomFilterDuplicateRemover</td>
<td>使用BloomFilter来进行去重，占用内存较小，但是可能漏抓页面</td>
</tr>
</tbody></table>
<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220922215225267.png" srcset="/img/loading.gif" lazyload alt="image-20220922215225267"></p>
<p>RedisScheduler是使用Redis的set进行去重，其他的Scheduler默认都使用HashSetDuplicateRemover来进行去重。</p>
<p>如果要使用BloomFilter，必须要加入以下依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--WebMagic对布隆过滤器的支持--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.guava<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>guava<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>16.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Spider</span> <span class="hljs-variable">spider</span> <span class="hljs-operator">=</span> Spider.create(<span class="hljs-keyword">new</span> <span class="hljs-title class_">JobProcessor</span>())<br>                <span class="hljs-comment">//初始访问url地址</span><br>                .addUrl(<span class="hljs-string">&quot;https://getp.gitee.io/docs/&quot;</span>)<br>                <span class="hljs-comment">// 保存到文件</span><br>                .addPipeline(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FilePipeline</span>(<span class="hljs-string">&quot;C:\\Users\\Administrator.SC-201902031211\\Desktop\\result&quot;</span>))<br>                .setScheduler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">QueueScheduler</span>()<br>                .setDuplicateRemover(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BloomFilterDuplicateRemover</span>(<span class="hljs-number">10000000</span>))) <span class="hljs-comment">//参数设置需要对多少条数据去重</span><br>                .thread(<span class="hljs-number">5</span>);<span class="hljs-comment">// 设置有5个线程处理</span><br><br>        <span class="hljs-type">Scheduler</span> <span class="hljs-variable">scheduler</span> <span class="hljs-operator">=</span> spider.getScheduler();<br>        spider.run();<br>    &#125;<br></code></pre></td></tr></table></figure>

<h4 id="三种去重方式"><a href="#三种去重方式" class="headerlink" title="三种去重方式"></a>三种去重方式</h4><p>去重就有三种实现方式，那有什么不同呢？</p>
<ul>
<li>HashSet</li>
</ul>
<p>使用java中的HashSet不能重复的特点去重。优点是容易理解。使用方便。</p>
<p>缺点：占用内存大，性能较低。</p>
<ul>
<li>Redis去重</li>
</ul>
<p>​	使用Redis的set进行去重。优点是速度快（Redis本身速度就很快），而且去重不会占用爬虫服务器的资源，可以处理更大数据量的数据爬取。</p>
<p>缺点：需要准备Redis服务器，增加开发和使用成本。</p>
<ul>
<li>布隆过滤器（BloomFilter）</li>
</ul>
<p>使用布隆过滤器也可以实现去重。优点是占用的内存要比使用HashSet要小的多，也适合大量数据的去重操作。</p>
<p>缺点：有误判的可能。没有重复可能会判定重复，但是重复数据一定会判定重复。</p>
<h3 id="7-4案例实现"><a href="#7-4案例实现" class="headerlink" title="7.4案例实现"></a>7.4案例实现</h3><h4 id="创建工程"><a href="#创建工程" class="headerlink" title="创建工程"></a>创建工程</h4><p>创建Maven工程，并加入依赖。pom.xml为：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--SpringMVC--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--SpringData Jpa--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--MySQL连接包--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--WebMagic核心包--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>us.codecraft<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>webmagic-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.7.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-log4j12<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--WebMagic扩展--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>us.codecraft<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>webmagic-extension<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.7.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--WebMagic对布隆过滤器的支持--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.guava<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>guava<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>16.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--工具包--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-lang3<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>添加application.properties配置文件</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment">#DB Configuration:</span><br><span class="hljs-attr">spring.datasource.driverClassName</span>=<span class="hljs-string">com.mysql.jdbc.Driver</span><br><span class="hljs-attr">spring.datasource.url</span>=<span class="hljs-string">jdbc:mysql://127.0.0.1:3306/carwler</span><br><span class="hljs-attr">spring.datasource.username</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">spring.datasource.password</span>=<span class="hljs-string">root</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">#JPA Configuration:</span><br><span class="hljs-attr">spring.jpa.database</span>=<span class="hljs-string">MySQL</span><br><span class="hljs-attr">spring.jpa.show-sql</span>=<span class="hljs-string">true</span><br></code></pre></td></tr></table></figure>

<h4 id="编写Pojo"><a href="#编写Pojo" class="headerlink" title="编写Pojo"></a>编写Pojo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep.pojo;<br><br><span class="hljs-keyword">import</span> javax.persistence.Entity;<br><span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;<br><span class="hljs-keyword">import</span> javax.persistence.GenerationType;<br><span class="hljs-keyword">import</span> javax.persistence.Id;<br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> dep</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Entity</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JobInfo</span> &#123;<br><br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span><br>    <span class="hljs-keyword">private</span> Long id;<br>    <span class="hljs-keyword">private</span> String companyName;<br>    <span class="hljs-keyword">private</span> String companyAddr;<br>    <span class="hljs-keyword">private</span> String companyInfo;<br>    <span class="hljs-keyword">private</span> String jobName;<br>    <span class="hljs-keyword">private</span> String jobAddr;<br>    <span class="hljs-keyword">private</span> String jobInfo;<br>    <span class="hljs-keyword">private</span> Integer salaryMin;<br>    <span class="hljs-keyword">private</span> Integer salaryMax;<br>    <span class="hljs-keyword">private</span> String url;<br>    <span class="hljs-keyword">private</span> String time;<br><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCompanyName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> companyName;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCompanyName</span><span class="hljs-params">(String companyName)</span> &#123;<br>        <span class="hljs-built_in">this</span>.companyName = companyName;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCompanyAddr</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> companyAddr;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCompanyAddr</span><span class="hljs-params">(String companyAddr)</span> &#123;<br>        <span class="hljs-built_in">this</span>.companyAddr = companyAddr;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCompanyInfo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> companyInfo;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCompanyInfo</span><span class="hljs-params">(String companyInfo)</span> &#123;<br>        <span class="hljs-built_in">this</span>.companyInfo = companyInfo;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getJobName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> jobName;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setJobName</span><span class="hljs-params">(String jobName)</span> &#123;<br>        <span class="hljs-built_in">this</span>.jobName = jobName;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getJobAddr</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> jobAddr;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setJobAddr</span><span class="hljs-params">(String jobAddr)</span> &#123;<br>        <span class="hljs-built_in">this</span>.jobAddr = jobAddr;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getJobInfo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> jobInfo;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setJobInfo</span><span class="hljs-params">(String jobInfo)</span> &#123;<br>        <span class="hljs-built_in">this</span>.jobInfo = jobInfo;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getSalaryMin</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> salaryMin;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSalaryMin</span><span class="hljs-params">(Integer salaryMin)</span> &#123;<br>        <span class="hljs-built_in">this</span>.salaryMin = salaryMin;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getSalaryMax</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> salaryMax;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSalaryMax</span><span class="hljs-params">(Integer salaryMax)</span> &#123;<br>        <span class="hljs-built_in">this</span>.salaryMax = salaryMax;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUrl</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> url;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUrl</span><span class="hljs-params">(String url)</span> &#123;<br>        <span class="hljs-built_in">this</span>.url = url;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getTime</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> time;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTime</span><span class="hljs-params">(String time)</span> &#123;<br>        <span class="hljs-built_in">this</span>.time = time;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;JobInfo&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;id=&quot;</span> + id +<br>                <span class="hljs-string">&quot;, companyName=&#x27;&quot;</span> + companyName + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, companyAddr=&#x27;&quot;</span> + companyAddr + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, companyInfo=&#x27;&quot;</span> + companyInfo + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, jobName=&#x27;&quot;</span> + jobName + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, jobAddr=&#x27;&quot;</span> + jobAddr + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, jobInfo=&#x27;&quot;</span> + jobInfo + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, salaryMin=&quot;</span> + salaryMin +<br>                <span class="hljs-string">&quot;, salaryMax=&quot;</span> + salaryMax +<br>                <span class="hljs-string">&quot;, url=&#x27;&quot;</span> + url + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, time=&#x27;&quot;</span> + time + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h4 id="编写Dao"><a href="#编写Dao" class="headerlink" title="编写Dao"></a>编写Dao</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.ep.pojo.JobInfo;<br><span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;<br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> dep</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">JobInfoDao</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaRepository</span>&lt;JobInfo,Long&gt; &#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="编写Service"><a href="#编写Service" class="headerlink" title="编写Service"></a>编写Service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep.service;<br><br><span class="hljs-keyword">import</span> com.ep.pojo.JobInfo;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> dep</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">JobInfoService</span> &#123;<br><br>    <span class="hljs-comment">/***</span><br><span class="hljs-comment">     * 保存数据</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> jobInfo</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(JobInfo jobInfo)</span>;<br><br>    <span class="hljs-comment">/***</span><br><span class="hljs-comment">     * 根据条件查找</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> jobInfo</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> List&lt;JobInfo&gt; <span class="hljs-title function_">findJobInfo</span><span class="hljs-params">(JobInfo jobInfo)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="编写Service实现类"><a href="#编写Service实现类" class="headerlink" title="编写Service实现类"></a>编写Service实现类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep.service.impl;<br><br><span class="hljs-keyword">import</span> com.ep.dao.JobInfoDao;<br><span class="hljs-keyword">import</span> com.ep.pojo.JobInfo;<br><span class="hljs-keyword">import</span> com.ep.service.JobInfoService;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.data.domain.Example;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> dep</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JobInfoServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">JobInfoService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> JobInfoDao jobInfoDao;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(JobInfo jobInfo)</span> &#123;<br>        <span class="hljs-comment">//先从数据库查询数据,根据发布日期查询和url查询</span><br>        <span class="hljs-type">JobInfo</span> <span class="hljs-variable">param</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JobInfo</span>();<br>        param.setUrl(jobInfo.getUrl());<br>        param.setTime(jobInfo.getTime());<br>        List&lt;JobInfo&gt; list = <span class="hljs-built_in">this</span>.findJobInfo(param);<br><br>        <span class="hljs-keyword">if</span> (list.size() == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">//没有查询到数据则新增或者修改数据</span><br>            <span class="hljs-built_in">this</span>.jobInfoDao.saveAndFlush(jobInfo);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;JobInfo&gt; <span class="hljs-title function_">findJobInfo</span><span class="hljs-params">(JobInfo jobInfo)</span> &#123;<br>        <span class="hljs-type">Example</span> <span class="hljs-variable">example</span> <span class="hljs-operator">=</span> Example.of(jobInfo);<br>        List&lt;JobInfo&gt; list = <span class="hljs-built_in">this</span>.jobInfoDao.findAll(example);<br>        <span class="hljs-keyword">return</span> list;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="编写引导类"><a href="#编写引导类" class="headerlink" title="编写引导类"></a>编写引导类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep;<br><br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><span class="hljs-keyword">import</span> org.springframework.scheduling.annotation.EnableScheduling;<br><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableScheduling</span> <span class="hljs-comment">// 开启定时任务</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebMagicItemApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(WebMagicItemApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="功能实现"><a href="#功能实现" class="headerlink" title="功能实现"></a>功能实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep.task;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSONArray;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSONObject;<br><span class="hljs-keyword">import</span> com.ep.dao.JobInfoDao;<br><span class="hljs-keyword">import</span> com.ep.pojo.JobInfo;<br><span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;<br><span class="hljs-keyword">import</span> org.springframework.scheduling.annotation.Scheduled;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> us.codecraft.webmagic.Page;<br><span class="hljs-keyword">import</span> us.codecraft.webmagic.Site;<br><span class="hljs-keyword">import</span> us.codecraft.webmagic.Spider;<br><span class="hljs-keyword">import</span> us.codecraft.webmagic.processor.PageProcessor;<br><span class="hljs-keyword">import</span> us.codecraft.webmagic.scheduler.BloomFilterDuplicateRemover;<br><span class="hljs-keyword">import</span> us.codecraft.webmagic.scheduler.QueueScheduler;<br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> dep</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JobProcess</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PageProcessor</span> &#123;<br>    <br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(Page page)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">jsonText</span> <span class="hljs-operator">=</span> page.getHtml().css(<span class="hljs-string">&quot;script&quot;</span>).regex(<span class="hljs-string">&quot;.*SEARCH_RESULT.*&quot;</span>).get();<br>        <span class="hljs-comment">//把获取到的数据变成Json对象</span><br>        <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(jsonText))&#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">substring</span> <span class="hljs-operator">=</span> jsonText.substring(jsonText.indexOf(<span class="hljs-string">&quot;&#123;&quot;</span>), jsonText.lastIndexOf(<span class="hljs-string">&quot;&#125;&quot;</span>) + <span class="hljs-number">1</span>);<br>            <span class="hljs-type">JSONObject</span> <span class="hljs-variable">parse</span> <span class="hljs-operator">=</span>(JSONObject) JSONObject.parse(substring);<br>            <span class="hljs-type">JSONArray</span> <span class="hljs-variable">engine_jds</span> <span class="hljs-operator">=</span> parse.getJSONArray(<span class="hljs-string">&quot;engine_jds&quot;</span>);<br>            page.putField(<span class="hljs-string">&quot;engine_jds&quot;</span>,engine_jds);<br>            <span class="hljs-keyword">if</span> (engine_jds.size()&gt;<span class="hljs-number">0</span>)&#123;<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; engine_jds.size(); i++) &#123;<br>                    <span class="hljs-type">JSONObject</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> (JSONObject)engine_jds.get(i);<br>                    JobInfo item=<span class="hljs-keyword">new</span> <span class="hljs-title class_">JobInfo</span>();<br>                    item.setCompanyName(o.get(<span class="hljs-string">&quot;company_name&quot;</span>).toString());<br>                    item.setCompanyAddr(o.get(<span class="hljs-string">&quot;workarea_text&quot;</span>).toString());<br>                    item.setCompanyInfo(o.get(<span class="hljs-string">&quot;companytype_text&quot;</span>).toString()+o.get(<span class="hljs-string">&quot;companyind_text&quot;</span>).toString()+o.get(<span class="hljs-string">&quot;companysize_text&quot;</span>).toString());<br>                    item.setJobName(o.get(<span class="hljs-string">&quot;job_name&quot;</span>).toString());<br>                    item.setJobAddr(o.get(<span class="hljs-string">&quot;workarea_text&quot;</span>).toString());<br>                    item.setJobInfo(o.get(<span class="hljs-string">&quot;jobwelf&quot;</span>).toString());<br>                    item.setSalary(o.get(<span class="hljs-string">&quot;providesalary_text&quot;</span>).toString());<br>                    item.setUrl(o.get(<span class="hljs-string">&quot;job_href&quot;</span>).toString());<br>                    item.setTime(o.get(<span class="hljs-string">&quot;issuedate&quot;</span>).toString());<br>                    page.putField(<span class="hljs-string">&quot;item&quot;</span>+i,item);<br>                &#125;<br>                <span class="hljs-comment">//获取下一页的数据，加入到任务schedule中</span><br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;=<span class="hljs-number">5</span> ; i++) &#123;<br>                    System.out.println(<span class="hljs-string">&quot;第&quot;</span>+i+<span class="hljs-string">&quot;次爬虫&quot;</span>);<br>                    page.addTargetRequest(<span class="hljs-string">&quot;https://search.51job.com/list/000000,000000,0000,00,9,99,java,2,&quot;</span>+i+<span class="hljs-string">&quot;.html?lang=c&amp;postchannel=0000&amp;workyear=99&amp;cotype=99&amp;degreefrom=99&amp;jobterm=99&amp;companysize=99&amp;ord_field=0&amp;dibiaoid=0&amp;line=&amp;welfare=&quot;</span>);<br>                &#125;<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">return</span>;<span class="hljs-comment">//如果没有数据结束爬虫</span><br>            &#125;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            System.out.println(<span class="hljs-string">&quot;没爬到数据&quot;</span>);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>    &#125;<br>        <span class="hljs-comment">// 解析页面，获取招聘详情信息，保存数据</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveJobInfo</span><span class="hljs-params">(Page page)</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Site</span> <span class="hljs-variable">site</span> <span class="hljs-operator">=</span> Site.me()<br>            .setCharset(<span class="hljs-string">&quot;gbk&quot;</span>) <span class="hljs-comment">// 设置编码</span><br>            .setTimeOut(<span class="hljs-number">10</span>*<span class="hljs-number">1000</span>) <span class="hljs-comment">// 设置超时时间</span><br>            .setRetrySleepTime(<span class="hljs-number">3000</span>) <span class="hljs-comment">// 设置重试的间隔时间</span><br>            .addHeader(<span class="hljs-string">&quot;User-Agent&quot;</span>,<span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36&quot;</span>)<br>            .addCookie(<span class="hljs-string">&quot;token&quot;</span>,<span class="hljs-string">&quot;152b9b67425a79e7ddbb859db35f1083632dac9e&quot;</span>)<br>            .setRetryTimes(<span class="hljs-number">3</span>); <span class="hljs-comment">// 设置重试的次数</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Site <span class="hljs-title function_">getSite</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> site;<br>    &#125;<br><br>    <span class="hljs-comment">// initialDelay当任务启动后，等等多久执行方法</span><br>    <span class="hljs-comment">// fixDelay每个多久执行方法</span><br>    <span class="hljs-meta">@Scheduled(initialDelay = 1000, fixedDelay = 100*1000)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 访问入口url</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https://search.51job.com/list/000000,000000,0000,01%252C32,9,99,java,2,1.html?lang=c&amp;stype=&amp;postchannel=0000&amp;workyear=99&amp;cotype=99&amp;degreefrom=99&amp;jobterm=99&amp;companysize=99&amp;providesalary=99&amp;lonlat=0%2C0&amp;radius=-1&amp;ord_field=0&amp;confirmdate=9&amp;fromType=&amp;dibiaoid=0&amp;address=&amp;line=&amp;specialarea=00&amp;from=&amp;welfare=&quot;</span>;<br>        Spider.create(<span class="hljs-keyword">new</span> <span class="hljs-title class_">JobProcess</span>())<br>                .addUrl(url)<br>                .setScheduler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">QueueScheduler</span>().setDuplicateRemover(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BloomFilterDuplicateRemover</span>(<span class="hljs-number">100000</span>)))<br>                .thread(<span class="hljs-number">10</span>)<br>                .run();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h4 id="使用和定制Pipeline"><a href="#使用和定制Pipeline" class="headerlink" title="使用和定制Pipeline"></a>使用和定制Pipeline</h4><p>在WebMagic中，Pileline是抽取结束后，进行处理的部分，它主要用于抽取结果的保存，也可以定制Pileline可以实现一些通用的功能。在这里我们会定制Pipeline实现数据导入到数据库中</p>
<p><strong>Pipeline输出</strong></p>
<p>Pipeline的接口定义如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Pipeline</span> &#123;<br>  <span class="hljs-comment">// ResultItems保存了抽取结果，它是一个Map结构，</span><br>  <span class="hljs-comment">// 在page.putField(key,value)中保存的数据，</span><br>  <span class="hljs-comment">//可以通过ResultItems.get(key)获取</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(ResultItems resultItems, Task task)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>可以看到，Pipeline其实就是将PageProcessor抽取的结果，继续进行了处理的，其实在Pipeline中完成的功能，你基本上也可以直接在PageProcessor实现，那么为什么会有Pipeline？有几个原因：</p>
<ul>
<li>为了模块分离</li>
</ul>
<p>“页面抽取”和“后处理、持久化”是爬虫的两个阶段，将其分离开来，一个是代码结构比较清晰，另一个是以后也可能将其处理过程分开，分开在独立的线程以至于不同的机器执行。</p>
<ul>
<li>Pipeline的功能比较固定，更容易做成通用组件</li>
</ul>
<p>每个页面的抽取方式千变万化，但是后续处理方式则比较固定，例如保存到文件、保存到数据库这种操作，这些对所有页面都是通用的。</p>
<p>在WebMagic里，一个Spider可以有多个Pipeline，使用Spider.addPipeline()即可增加一个Pipeline。这些Pipeline都会得到处理，例如可以使用</p>
<p>spider.addPipeline(new ConsolePipeline()).addPipeline(new FilePipeline())</p>
<p>实现输出结果到控制台，并且保存到文件的目标。</p>
<p>WebMagic中就已经提供了控制台输出、保存到文件、保存为JSON格式的文件几种通用的Pipeline。</p>
<table>
<thead>
<tr>
<th><strong>类</strong></th>
<th><strong>说明</strong></th>
<th><strong>备注</strong></th>
</tr>
</thead>
<tbody><tr>
<td>ConsolePipeline</td>
<td>输出结果到控制台</td>
<td>抽取结果需要实现toString方法</td>
</tr>
<tr>
<td>FilePipeline</td>
<td>保存结果到文件</td>
<td>抽取结果需要实现toString方法</td>
</tr>
<tr>
<td>JsonFilePipeline</td>
<td>JSON格式保存结果到文件</td>
<td></td>
</tr>
<tr>
<td>ConsolePageModelPipeline</td>
<td>(注解模式)输出结果到控制台</td>
<td></td>
</tr>
<tr>
<td>FilePageModelPipeline</td>
<td>(注解模式)保存结果到文件</td>
<td></td>
</tr>
<tr>
<td>JsonFilePageModelPipeline</td>
<td>(注解模式)JSON格式保存结果到文件</td>
<td>想持久化的字段需要有getter方法</td>
</tr>
</tbody></table>
<p>案例自定义Pipeline导入数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep.task;<br><br><br><span class="hljs-keyword">import</span> com.ep.pojo.JobInfo;<br><span class="hljs-keyword">import</span> com.ep.service.JobInfoService;<br><span class="hljs-keyword">import</span> net.minidev.json.JSONArray;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> us.codecraft.webmagic.ResultItems;<br><span class="hljs-keyword">import</span> us.codecraft.webmagic.Task;<br><span class="hljs-keyword">import</span> us.codecraft.webmagic.pipeline.Pipeline;<br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> dep</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringDataPipeline</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Pipeline</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> JobInfoService jobInfoService;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(ResultItems resultItems, Task task)</span> &#123;<br>        <span class="hljs-comment">// 获取封装好的招聘详情对象</span><br>        <span class="hljs-comment">// 如果不为空，就存储到数据库中</span><br>        <span class="hljs-type">JSONArray</span> <span class="hljs-variable">engine_jds</span> <span class="hljs-operator">=</span> resultItems.get(<span class="hljs-string">&quot;engine_jds&quot;</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; engine_jds.size(); i++) &#123;<br>            <span class="hljs-type">JobInfo</span> <span class="hljs-variable">jobInfo</span> <span class="hljs-operator">=</span> resultItems.get(<span class="hljs-string">&quot;item&quot;</span> + i);<br>            <span class="hljs-keyword">if</span> (jobInfo != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-comment">// 保存到数据库中</span><br>                jobInfoService.save(jobInfo);<br>            &#125;<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="8-扩展"><a href="#8-扩展" class="headerlink" title="8.扩展"></a>8.扩展</h2><h3 id="8-1-定时任务"><a href="#8-1-定时任务" class="headerlink" title="8.1. 定时任务"></a>8.1. 定时任务</h3><p>在案例中我们使用的是Spring内置的Spring Task，这是Spring3.0加入的定时任务功能。我们使用注解的方式定时启动爬虫进行数据爬取。</p>
<p>我们使用的是@Scheduled注解，其属性如下：</p>
<p>1）<strong>cron：</strong>cron表达式，指定任务在特定时间执行；</p>
<p>2）<strong>fixedDelay</strong>：上一次任务执行完后多久再执行，参数类型为long，单位ms</p>
<p>3）<strong>fixedDelayString：</strong>与fixedDelay含义一样，只是参数类型变为String</p>
<p>4）<strong>fixedRate：</strong>按一定的频率执行任务，参数类型为long，单位ms</p>
<p>5）<strong>fixedRateString:</strong> 与fixedRate的含义一样，只是将参数类型变为String</p>
<p>6）<strong>initialDelay：</strong>延迟多久再第一次执行任务，参数类型为long，单位ms</p>
<p>7）<strong>initialDelayString：</strong>与initialDelay的含义一样，只是将参数类型变为String</p>
<p>8）<strong>zone：</strong>时区，默认为当前时区，一般没有用到</p>
<p>我们这里的使用比较简单，固定的间隔时间来启动爬虫。例如可以实现项目启动后，每隔一小时启动一次爬虫。</p>
<p>但是有可能业务要求更高，并不是定时定期处理，而是在特定的时间进行处理，这个时候我们之前的使用方式就不能满足需求了。例如我要在工作日（周一到周五）的晚上八点执行。这时我们就需要Cron表达式了。</p>
<h4 id="8-1-1-Cron表达式"><a href="#8-1-1-Cron表达式" class="headerlink" title="8.1.1. Cron表达式"></a>8.1.1. Cron表达式</h4><p>cron的表达式是字符串，实际上是由七子表达式，描述个别细节的时间表。这些子表达式是分开的空白，代表：</p>
<ol>
<li><p>Seconds</p>
</li>
<li><p>Minutes</p>
</li>
<li><p>Hours</p>
</li>
<li><p>Day-of-Month</p>
</li>
<li><p>Month</p>
</li>
<li><p>Day-of-Week</p>
</li>
<li><p>Year (可选字段)</p>
</li>
</ol>
<p>例  “0 0 12 ? * WED” 在每星期三下午12:00 执行,</p>
<p> “*” 代表整个时间段</p>
<p>每一个字段都有一套可以指定有效值，如</p>
<p>Seconds (秒)		：可以用数字0－59 表示，</p>
<p>Minutes(分)		：可以用数字0－59 表示，</p>
<p>Hours(时)		：可以用数字0-23表示,</p>
<p>Day-of-Month(天)	：可以用数字1-31 中的任一一个值，但要注意一些特别的月份</p>
<p>Month(月) 		：可以用0-11 或用字符串:</p>
<p>JAN, FEB, MAR, APR, MAY, JUN, JUL, AUG, SEP, OCT, NOV, DEC </p>
<p>Day-of-Week(天)	：可以用数字1-7表示（1 ＝ 星期日）或用字符口串:</p>
<p>SUN, MON, TUE, WED, THU, FRI, SAT</p>
<p>“&#x2F;”：为特别单位，表示为“每”如“0&#x2F;15”表示每隔15分钟执行一次,“0”表示为从“0”分开始, “3&#x2F;20”表示表示每隔20分钟执行一次，“3”表示从第3分钟开始执行</p>
<p>“?”：表示每月的某一天，或第周的某一天</p>
<p>“L”：用于每月，或每周，表示为每月的最后一天，或每个月的最后星期几如“6L”表示“每月的最后一个星期五” </p>
<p>可以使用课堂资料的**CronExpBuilder(表达式生成器)**生成表达式</p>
<h4 id="8-1-2Cron测试"><a href="#8-1-2Cron测试" class="headerlink" title="8.1.2Cron测试"></a>8.1.2Cron测试</h4><p>先把之前爬虫的@Component注解取消，避免干扰测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JobProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PageProcessor</span> &#123;<br></code></pre></td></tr></table></figure>

<p>编写使用Cron表达式的测试用例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep.task;<br><br><span class="hljs-keyword">import</span> org.springframework.scheduling.annotation.Scheduled;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> dep</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskTest</span> &#123;<br><br>    <span class="hljs-meta">@Scheduled(cron = &quot;0/5 * * * * *&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(LocalDateTime.now() + <span class="hljs-string">&quot;任务执行了&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="8-2-网页去重"><a href="#8-2-网页去重" class="headerlink" title="8.2. 网页去重"></a>8.2. 网页去重</h3><p>之前我们对下载的url地址进行了去重操作，避免同样的url下载多次。其实不光url需要去重，我们对下载的内容也需要去重。</p>
<p>在网上我们可以找到许多内容相似的文章。但是实际我们只需要其中一个即可，同样的内容没有必要下载多次，那么如何进行去重就需要进行处理了</p>
<h4 id="8-2-1-去重方案介绍"><a href="#8-2-1-去重方案介绍" class="headerlink" title="8.2.1. 去重方案介绍"></a>8.2.1. 去重方案介绍</h4><p>指纹码对比</p>
<p>最常见的去重方案是生成文档的指纹门。例如对一篇文章进行MD5加密生成一个字符串，我们可以认为这是文章的指纹码，再和其他的文章指纹码对比，一致则说明文章重复。</p>
<p>但是这种方式是完全一致则是重复的，如果文章只是多了几个标点符号，那仍旧被认为是重复的，这种方式并不合理。</p>
<p>BloomFilter</p>
<p>这种方式就是我们之前对url进行去重的方式，使用在这里的话，也是对文章进行计算得到一个数，再进行对比，缺点和方法1是一样的，如果只有一点点不一样，也会认为不重复，这种方式不合理。</p>
<p>KMP算法</p>
<p>KMP算法是一种改进的字符串匹配算法。KMP算法的关键是利用匹配失败后的信息，尽量减少模式串与主串的匹配次数以达到快速匹配的目的。能够找到两个文章有哪些是一样的，哪些不一样。</p>
<p>这种方式能够解决前面两个方式的“只要一点不一样就是不重复”的问题。但是它的时空复杂度太高了，不适合大数据量的重复比对。</p>
<p>还有一些其他的去重方式：最长公共子串、后缀数组、字典树、DFA等等，但是这些方式的空复杂度并不适合数据量较大的工业应用场景。我们需要找到一款性能高速度快，能够进行相似度对比的去重方案</p>
<p>Google 的 simhash 算法产生的签名，可以满足上述要求。这个算法并不深奥，比较容易理解。这种算法也是目前Google搜索引擎所目前所使用的网页去重算法。</p>
<h4 id="8-2-2-SimHash"><a href="#8-2-2-SimHash" class="headerlink" title="8.2.2. SimHash"></a>8.2.2. SimHash</h4><h5 id="流程介绍"><a href="#流程介绍" class="headerlink" title="流程介绍"></a>流程介绍</h5><p>simhash是由 Charikar 在2002年提出来的，为了便于理解尽量不使用数学公式，分为这几步：</p>
<p><strong>1、分词</strong>，把需要判断文本分词形成这个文章的特征单词。</p>
<p><strong>2、hash</strong>，通过hash算法把每个词变成hash值，比如“美国”通过hash算法计算为 100101,“51区”通过hash算法计算为 101011。这样我们的字符串就变成了一串串数字。</p>
<p><strong>3、加权</strong>，通过 2步骤的hash生成结果，需要按照单词的权重形成加权数字串，“美国”的hash值为“100101”，通过加权计算为“4 -4 -4 4 -4 4”</p>
<p>“51区”计算为 “ 5 -5 5 -5 5 5”。</p>
<p><strong>4、合并</strong>，把上面各个单词算出来的序列值累加，变成只有一个序列串。</p>
<p> “美国”的 “4 -4 -4 4 -4 4”，“51区”的 “ 5 -5 5 -5 5 5”</p>
<p>把每一位进行累加， “4+5 -4+-5 -4+5 4+-5 -4+5 4+5”à“9 -9 1 -1 1 9”</p>
<p><strong>5、降维</strong>，把算出来的 “9 -9 1 -1 1 9”变成 0 1 串，形成最终的simhash签名。 </p>
<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220923223520565.png" srcset="/img/loading.gif" lazyload alt="image-20220923223520565"></p>
<p><strong>签名距离计算</strong></p>
<p>我们把库里的文本都转换为simhash签名，并转换为long类型存储，空间大大减少。现在我们虽然解决了空间，但是如何计算两个simhash的相似度呢？</p>
<p>我们通过海明距离（Hamming distance）就可以计算出两个simhash到底相似不相似。两个simhash对应二进制（01串）取值不同的数量称为这两个simhash的海明距离。</p>
<p>举例如下： 10101 和 00110 从第一位开始依次有第一位、第四、第五位不同，则海明距离为3。对于二进制字符串的a和b，海明距离为等于在a XOR b运算结果中1的个数（普遍算法）。</p>
<p><strong>导入simhash工程</strong></p>
<p>参考项目：<a target="_blank" rel="noopener" href="https://github.com/CreekLou/simhash.git">https://github.com/CreekLou/simhash.git</a></p>
<p>这个项目不能直接使用，因为jar包的问题，需要进行改造。这里使用课堂资料中已经改造好的。</p>
<h3 id="8-3-代理的使用"><a href="#8-3-代理的使用" class="headerlink" title="8.3 代理的使用"></a>8.3 代理的使用</h3><p>有些网站不允许爬虫进行数据爬取，因为会加大服务器的压力。其中一种最有效的方式是通过ip+时间进行鉴别，因为正常人不可能短时间开启太多的页面，发起太多的请求。</p>
<p>我们使用的WebMagic可以很方便的设置爬取数据的时间（参考第二天的的3.1. 爬虫的配置、启动和终止）。但是这样会大大降低我们爬取数据的效率，如果不小心ip被禁了，会让我们无法爬去数据，那么我们就有必要使用代理服务器来爬取数据。</p>
<h4 id="8-3-1-代理服务器"><a href="#8-3-1-代理服务器" class="headerlink" title="8.3.1. 代理服务器"></a>8.3.1. 代理服务器</h4><p>代理（英语：Proxy），也称网络代理，是一种特殊的网络服务，允许一个网络终端（一般为客户端）通过这个服务与另一个网络终端（一般为服务器）进行非直接的连接。</p>
<p>提供代理服务的电脑系统或其它类型的网络终端称为代理服务器（英文：Proxy Server）。一个完整的代理请求过程为：客户端首先与代理服务器创建连接，接着根据代理服务器所使用的代理协议，请求对目标服务器创建连接、或者获得目标服务器的指定资源。</p>
<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220923223913246.png" srcset="/img/loading.gif" lazyload alt="image-20220923223913246"></p>
<p>我们就需要知道代理服务器在哪里（ip和端口号）才可以使用。网上有很多代理服务器的提供商，但是大多是免费的不好用，付费的还行。</p>
<p>提供两个免费代理ip的服务商网站：</p>
<p>米扑代理</p>
<p><a target="_blank" rel="noopener" href="https://proxy.mimvp.com/free.php">https://proxy.mimvp.com/free.php</a></p>
<p>西刺免费代理IP</p>
<p><a target="_blank" rel="noopener" href="http://www.xicidaili.com/">http://www.xicidaili.com/</a></p>
<p>上面两个失效了</p>
<p><a target="_blank" rel="noopener" href="http://www.66ip.cn/">http://www.66ip.cn/</a></p>
<h4 id="8-3-2-使用代理"><a href="#8-3-2-使用代理" class="headerlink" title="8.3.2. 使用代理"></a>8.3.2. 使用代理</h4><p>WebMagic使用的代理APIProxyProvider。因为相对于Site的“配置”，ProxyProvider定位更多是一个“组件”，所以代理不再从Site设置，而是由HttpClientDownloader设置。</p>
<table>
<thead>
<tr>
<th>API</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>HttpClientDownloader.setProxyProvider(ProxyProvider proxyProvider)</td>
<td>设置代理</td>
</tr>
</tbody></table>
<p>ProxyProvider有一个默认实现：SimpleProxyProvider。它是一个基于简单Round-Robin的、没有失败检查的ProxyProvider。可以配置任意个候选代理，每次会按顺序挑选一个代理使用。它适合用在自己搭建的比较稳定的代理的场景。</p>
<p>如果需要根据实际使用情况对代理服务器进行管理（例如校验是否可用，定期清理、添加代理服务器等），只需要自己实现APIProxyProvider即可。</p>
<p>可以访问网址<a target="_blank" rel="noopener" href="http://ip.json-json.com/">http://ip.json-json.com/</a> 测试当前请求的ip</p>
<p>为了避免干扰，把其他任务的@Component注释掉，在案例中加入编写以下逻辑：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep.task;<br><br><span class="hljs-keyword">import</span> org.springframework.scheduling.annotation.Scheduled;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> us.codecraft.webmagic.Page;<br><span class="hljs-keyword">import</span> us.codecraft.webmagic.Site;<br><span class="hljs-keyword">import</span> us.codecraft.webmagic.Spider;<br><span class="hljs-keyword">import</span> us.codecraft.webmagic.downloader.HttpClientDownloader;<br><span class="hljs-keyword">import</span> us.codecraft.webmagic.processor.PageProcessor;<br><span class="hljs-keyword">import</span> us.codecraft.webmagic.proxy.Proxy;<br><span class="hljs-keyword">import</span> us.codecraft.webmagic.proxy.SimpleProxyProvider;<br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> dep</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyTest</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PageProcessor</span> &#123;<br>    <span class="hljs-meta">@Scheduled(fixedDelay = 1000*10)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Process</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 创建下载器Downloader</span><br>        <span class="hljs-type">HttpClientDownloader</span> <span class="hljs-variable">httpClientDownloader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpClientDownloader</span>();<br>        <span class="hljs-comment">// 给下载器设置代理服务器信息</span><br>        httpClientDownloader.setProxyProvider(SimpleProxyProvider.from(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(<span class="hljs-string">&quot;124.156.100.83&quot;</span>,<span class="hljs-number">8118</span>)));<br>        Spider.create(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ProxyTest</span>())<br>                .addUrl(<span class="hljs-string">&quot;http://ip.json-json.com/&quot;</span>)<br>                .setDownloader(httpClientDownloader) <span class="hljs-comment">// 设置下载器</span><br>                .run();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(Page page)</span> &#123;<br>        System.out.println(page.getHtml().css(<span class="hljs-string">&quot;body&quot;</span>).toString());<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Site</span> <span class="hljs-variable">site</span> <span class="hljs-operator">=</span> Site.me();<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Site <span class="hljs-title function_">getSite</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> site;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>


                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/">#网络爬虫</a>
      
        <a href="/tags/JAVA/">#JAVA</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>网络爬虫</div>
      <div>http://example.com/2022/09/23/网络爬虫/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Deng ErPu</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年9月23日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/09/29/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/" title="数据库常用操作">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">数据库常用操作</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/09/18/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" title="正则表达式">
                        <span class="hidden-mobile">正则表达式</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
