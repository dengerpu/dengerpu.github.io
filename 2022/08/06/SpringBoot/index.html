

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/icon.png">
  <link rel="icon" href="/img/icon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Deng ErPu">
  <meta name="keywords" content="">
  
    <meta name="description" content="SpringBoot1.创建SpringBoot项目 下面的包可以删掉Artifact   添加依赖 123456789101112131415161718192021222324252627282930313233343536&lt;!--web开发的起步依赖--&gt;&lt;dependency&gt;    &lt;groupId&gt;org.springframework.boot&amp;l">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBoot">
<meta property="og:url" content="http://example.com/2022/08/06/SpringBoot/index.html">
<meta property="og:site_name" content="会写Bug的小邓程序员">
<meta property="og:description" content="SpringBoot1.创建SpringBoot项目 下面的包可以删掉Artifact   添加依赖 123456789101112131415161718192021222324252627282930313233343536&lt;!--web开发的起步依赖--&gt;&lt;dependency&gt;    &lt;groupId&gt;org.springframework.boot&amp;l">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/article/springboot.png">
<meta property="article:published_time" content="2022-08-06T12:51:00.000Z">
<meta property="article:modified_time" content="2022-08-29T15:17:19.367Z">
<meta property="article:author" content="Deng ErPu">
<meta property="article:tag" content="SpringBoot">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/img/article/springboot.png">
  
  
  
  <title>SpringBoot - 会写Bug的小邓程序员</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/mac.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>爱写Bug的小邓程序员</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/bg.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="SpringBoot"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-08-06 20:51" pubdate>
          2022年8月6日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          37k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          306 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">SpringBoot</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h1><h2 id="1-创建SpringBoot项目"><a href="#1-创建SpringBoot项目" class="headerlink" title="1.创建SpringBoot项目"></a>1.创建SpringBoot项目</h2><p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220720163433556.png" srcset="/img/loading.gif" lazyload alt="image-20220720163433556"></p>
<p>下面的包可以删掉Artifact</p>
<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220720163634216.png" srcset="/img/loading.gif" lazyload alt="image-20220720163634216"></p>
<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220720163746008.png" srcset="/img/loading.gif" lazyload alt="image-20220720163746008"></p>
<p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--web开发的起步依赖--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--springboot集成junit测试的起步依赖--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--热部署--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-devtools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--mybatis-plus启动器--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--lombok用于简化实体类开发--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--mysql驱动--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>编写一个测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestController</span> &#123;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/test&quot;)</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-keyword">public</span> ResultInfo <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">ResultInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResultInfo</span>();<br>        info.setStatus(<span class="hljs-number">201</span>);<br>        info.setMessage(<span class="hljs-string">&quot;请求成功&quot;</span>);<br>        <span class="hljs-keyword">return</span> info;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>配置数据源</p>
<p>application.xml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-comment"># 配置数据源信息</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-comment"># 配置数据源类型</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">com.zaxxer.hikari.HikariDataSource</span><br>    <span class="hljs-comment"># 配置连接数据库信息</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/management_system?serverTimezone=GMT%2B8&amp;characterEncoding=utf-8&amp;useSSL=false</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8888</span><br><br><span class="hljs-comment"># 配置mybatis日志</span><br><span class="hljs-attr">mybatis-plus:</span><br>  <span class="hljs-attr">configuration:</span><br>    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span><br></code></pre></td></tr></table></figure>

<h2 id="2-JWT"><a href="#2-JWT" class="headerlink" title="2.JWT"></a>2.JWT</h2><p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.auth0<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>java-jwt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220720213241796.png" srcset="/img/loading.gif" lazyload alt="image-20220720213241796"></p>
<h3 id="2-1-创建JWT工具类"><a href="#2-1-创建JWT工具类" class="headerlink" title="2.1. 创建JWT工具类"></a>2.1. 创建JWT工具类</h3><p>创建操作JWT的工具类</p>
<p>jwt&#x2F;JwtUtil</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.auth0.jwt.JWT;<br><span class="hljs-keyword">import</span> com.auth0.jwt.JWTCreator;<br><span class="hljs-keyword">import</span> com.auth0.jwt.algorithms.Algorithm;<br><span class="hljs-keyword">import</span> com.auth0.jwt.interfaces.Claim;<br><span class="hljs-keyword">import</span> com.auth0.jwt.interfaces.DecodedJWT;<br><span class="hljs-keyword">import</span> com.auth0.jwt.interfaces.JWTVerifier;<br><span class="hljs-keyword">import</span> com.ep.pojo.User;<br><span class="hljs-keyword">import</span> com.ep.service.UserService;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-keyword">import</span> java.util.Calendar;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtUtil</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> UserService userService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setService</span><span class="hljs-params">(UserService userService)</span>  &#123;<br>        JwtUtil.userService = userService;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 生成token</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">createToken</span><span class="hljs-params">(User user)</span> &#123;<br>        <span class="hljs-type">Calendar</span> <span class="hljs-variable">calendar</span> <span class="hljs-operator">=</span> Calendar.getInstance();<br>        calendar.add(Calendar.DATE, <span class="hljs-number">7</span>); <span class="hljs-comment">//默认令牌过期时间7天</span><br>        JWTCreator.<span class="hljs-type">Builder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> JWT.create();<br>        builder.withClaim(<span class="hljs-string">&quot;id&quot;</span>, user.getId())<br>                .withClaim(<span class="hljs-string">&quot;username&quot;</span>, user.getUsername())<br>                .withClaim(<span class="hljs-string">&quot;rid&quot;</span>, user.getRid());<br><br>        <span class="hljs-keyword">return</span> builder.withExpiresAt(calendar.getTime())<br>                .sign(Algorithm.HMAC256(user.getPassword()));<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 解析token</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DecodedJWT <span class="hljs-title function_">verifyToken</span><span class="hljs-params">(String token)</span> &#123;<br>        <span class="hljs-keyword">if</span> (token==<span class="hljs-literal">null</span>)&#123;<br>            System.out.println(<span class="hljs-string">&quot;token不能为空&quot;</span>);<br>        &#125;<br>        <span class="hljs-type">Claim</span> <span class="hljs-variable">claim</span> <span class="hljs-operator">=</span> getClaimByName(token,<span class="hljs-string">&quot;id&quot;</span>);<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> claim.asInt(); <span class="hljs-comment">//获取token里存储的id</span><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.getById(id); <span class="hljs-comment">//根据id在数据库中查询数据信息</span><br>        <span class="hljs-comment">//获取登录用户的密码，根据密码校验token</span><br>        <span class="hljs-type">JWTVerifier</span> <span class="hljs-variable">build</span> <span class="hljs-operator">=</span> JWT.require(Algorithm.HMAC256(user.getPassword())).build();<br>        <span class="hljs-keyword">return</span> build.verify(token);<br>    &#125;<br><br>    <span class="hljs-comment">//获取存储在token里面的字段（上面存储的是id,username,rid,这个方法就是获取这些字段）</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Claim <span class="hljs-title function_">getClaimByName</span><span class="hljs-params">(String token, String name)</span>&#123;<br>        <span class="hljs-keyword">return</span> JWT.decode(token).getClaim(name);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-2-创建JWT拦截器"><a href="#2-2-创建JWT拦截器" class="headerlink" title="2.2. 创建JWT拦截器"></a>2.2. 创建JWT拦截器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.auth0.jwt.exceptions.AlgorithmMismatchException;<br><span class="hljs-keyword">import</span> com.auth0.jwt.exceptions.SignatureVerificationException;<br><span class="hljs-keyword">import</span> com.auth0.jwt.exceptions.TokenExpiredException;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span>: token 拦截器</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JWTInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> &#123;<br>        <span class="hljs-comment">// 前端将获取到的token存储到请求头的Authorization字段里，</span><br>        <span class="hljs-comment">//获取前端发送过来的token</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">&quot;Authorization&quot;</span>);<br>        log.info(<span class="hljs-string">&quot;token：&quot;</span> + token);<br><br>        <span class="hljs-keyword">if</span> (token == <span class="hljs-literal">null</span>) &#123;<br>            log.error(<span class="hljs-string">&quot;token为空&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            JwtUtil.verifyToken(token);<br>        &#125; <span class="hljs-keyword">catch</span> (SignatureVerificationException e) &#123;<br>            log.error(<span class="hljs-string">&quot;无效签名&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (TokenExpiredException e) &#123;<br>            log.error(<span class="hljs-string">&quot;token过&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (AlgorithmMismatchException e) &#123;<br>            log.error(<span class="hljs-string">&quot;token算法不一致&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(<span class="hljs-string">&quot;token无效&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<h3 id="2-3-创建JWT配置类"><a href="#2-3-创建JWT配置类" class="headerlink" title="2.3. 创建JWT配置类"></a>2.3. 创建JWT配置类</h3><p>IntercaptorConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.ep.jwt.JWTInterceptor;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;<br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * jwt拦截器</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IntercaptorConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> &#123;<br>        registry.addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">JWTInterceptor</span>())<br>                <span class="hljs-comment">//拦截的路径</span><br>                .addPathPatterns(<span class="hljs-string">&quot;/*&quot;</span>)<br>                <span class="hljs-comment">//排除接口</span><br>                .excludePathPatterns(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;/login&quot;</span>, <span class="hljs-string">&quot;/register&quot;</span>,<span class="hljs-string">&quot;/test&quot;</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="3-接口返回规范"><a href="#3-接口返回规范" class="headerlink" title="3.接口返回规范"></a>3.接口返回规范</h2><h3 id="3-1状态码"><a href="#3-1状态码" class="headerlink" title="3.1状态码"></a>3.1状态码</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E7%8A%B6%E6%80%81%E7%A0%81&spm=1001.2101.3001.7020">状态码</a>类别<br>1XX（信息性状态码）表示接收的请求正在处理<br>2XX（成功状态码）表示请求正常处理完毕<br>3XX（<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E9%87%8D%E5%AE%9A%E5%90%91&spm=1001.2101.3001.7020">重定向</a>状态码）表示需要进行附加操作以完成请求<br>4XX（客户端错误状态码）表示服务器无法处理请求<br>5XX（服务器错误状态码）表示服务器处理请求出错</p>
</blockquote>
<p><strong>100（临时响应）表示临时响应并需要请求这继续执行操作的状态码</strong></p>
<p><code>100</code>-继续请求者应当继续提出请求。服务器返回此代码表示已收到请求的一部分，正在等待其余部分。<br><code>101</code>-切换协议 请求者已要求服务器切换协议，服务器已确认并准备切换。</p>
<p><strong>200（成功）表示成功处理了请求的状态码</strong></p>
<p><code>200</code>-成功 服务器已经成功处理了请求。通常，这表示服务器提供了请求的网页。<br><code>201</code>-已创建 请求成功并且服务器创建了新的资源。<br><code>202</code>-已接受 服务器已接受请求，但尚未处理。<br><code>203</code>-非授权信息 服务器已经成功处理了请求，但返回的信息可能来自别的资源。<br><code>204</code>-无内容 服务器成功处理了请求，但没有返回任何内容。<br><code>205</code>-重置内容 服务器成功处理了请求，但没有返回任何内容。<br><code>206</code>-部分内容 服务器成功处理 了部分GET请求。</p>
<p><strong>300（重定向）表示要完成请求，需要进一步操作。通常，这些状态代码用来重定向</strong><br><code>300</code>-多种选择 针对请求，服务器可执行多种操作。服务器可根据请求者（user agent）选择一项操作，或提供操作列表提供请求者选择。<br><code>301</code>-永久移动 请求的网页已永久移动到新位置。服务器回返此响应（对GET或HEAD请求的响应）时，会自动将请求者转到新位置<br><code>302</code>- 临时移动 服务器目前从不同位置的网页响应请求，但请求者应继续使用原有位置来进行以后的请求。<br><code>303</code>-查看其它位置 请求者应当对不同的位置使用单独的GET请求来检索响应时，服务器返回此代码。<br><code>304</code>-未修改 自上次请求后，请求的网页未修改过。服务器返回此响应，不会返回网页的内容。<br><code>305</code>-使用代理 请求者只能使用代理访问请求的网页。如果服务器返回此响应，还表示请求者应使用代理。<br><code>307</code>-临时性重定向 服务器目前从不同位置的网页响应请求，但请求者应继续使用原有的位置来进行以后的请求。<br><strong>400（请求错误）这些状态码表示可能出错，妨碍了服务器的处理</strong><br><code>400</code>-错误请求 服务器不理解请求的语法。<br><code>401</code>-未授权 请求要求身份验证。对于需要登陆的网页，服务器可能返回此响应。<br><code>403</code>-禁止 服务器拒绝请求。<br><code>404</code>-未找到 服务器到不到请求的网页。<br><code>405</code>-方法禁用 禁用请求中指定的方法。<br><code>406</code>-不接受 无法使用请求的内容特性响应请求的网页。<br><code>407</code>-需要代理授权 此状态码与401（未授权）类似，但指定请求者应当授权使用代理。<br><code>408</code>-请求超时 服务器等候请求时发生超时。<br><code>409</code>-冲突 服务器在完成请求时发生冲突。服务器必须在响应中包含有关冲突的信息。<br><code>410</code>- 已删除 如果请求的资源已永久删除，服务器就会返回此响应。<br><code>411</code>-需要有效长度 服务器不接受不含有效内容长度标头字段的请求。<br><code>412</code>-未满足前提条件 服务器未满足请求者在请求者设置的其中一个前提条件。<br><code>413</code>-请求实体过大 服务器无法处理请求，因为请求实体过大，超出了服务器的处理能力。<br><code>414</code>-请求的URI过长 请求的URI（通常为网址）过长，服务器无法处理。<br><code>415</code>- 不支持媒体类型 请求的格式不受请求页面的支持。<br><code>416</code>-请求范围不符合要求 如果页面无法提供请求的范围，则服务器会返回此状态码。<br><code>417</code>-未满足期望值 服务器未满足“期望”请求标头字段的要求</p>
<p><strong>500（服务器错误）这些状态码表示服务器在尝试处理请求时发生内部错误。这些错误可能是服务器本身的错误，而不是请求出错</strong><br><code>500</code>-服务器内部错误 服务器遇到错误，无法完成请求。<br><code>501</code> - 尚未实施 服务器不具备完成请求的功能。例如，服务器无法识别请求方法时可能会返回此代码。<br><code>502</code> - 错误网关 服务器作为网关或代理，从上游服务器无法收到无效响应。<br><code>503</code> - 服务器不可用 服务器目前无法使用（由于超载或者停机维护）。通常，这只是暂时状态。<br><code>504</code> - 网关超时 服务器作为网关代理，但是没有及时从上游服务器收到请求。<br><code>505</code> - HTTP版本不受支持 服务器不支持请求中所用的HTTP协议版本。</p>
<h3 id="3-2状态码枚举类"><a href="#3-2状态码枚举类" class="headerlink" title="3.2状态码枚举类"></a>3.2状态码枚举类</h3><blockquote>
<p>使用状态码枚举类可以使后端返回给前端的状态码规范，方便维护</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep.utils;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ReturnCode</span> &#123;<br><br><br>    S200(<span class="hljs-number">200</span>,<span class="hljs-string">&quot;请求成功&quot;</span>),<br>    S201(<span class="hljs-number">201</span>,<span class="hljs-string">&quot;创建成功&quot;</span>),<br>    S204(<span class="hljs-number">204</span>,<span class="hljs-string">&quot;删除成功&quot;</span>),<br><br>    S400(<span class="hljs-number">400</span>,<span class="hljs-string">&quot;请求的地址不存在或者包含不支持的参数&quot;</span>),<br>    S401(<span class="hljs-number">401</span>,<span class="hljs-string">&quot;未授权&quot;</span>),<br>    S403(<span class="hljs-number">403</span>,<span class="hljs-string">&quot;被禁止访问&quot;</span>),<br>    S404(<span class="hljs-number">404</span>,<span class="hljs-string">&quot;请求资源不存在&quot;</span>),<br>    S422(<span class="hljs-number">422</span>,<span class="hljs-string">&quot;错误&quot;</span>),<br><br>    INVALID_TOKEN(<span class="hljs-number">2001</span>,<span class="hljs-string">&quot;访问令牌不合法&quot;</span>),<br>    ACCESS_DENIED(<span class="hljs-number">2003</span>,<span class="hljs-string">&quot;没有权限访问该资源&quot;</span>),<br>    CLIENT_AUTHENTICATION_FAILED(<span class="hljs-number">1001</span>,<span class="hljs-string">&quot;客户端认证失败&quot;</span>),<br>    USERNAME_OR_PASSWORD_ERROR(<span class="hljs-number">1002</span>,<span class="hljs-string">&quot;用户名或密码错误&quot;</span>),<br>    UNSUPPORTED_GRANT_TYPE(<span class="hljs-number">1003</span>, <span class="hljs-string">&quot;不支持的认证模式&quot;</span>);<br><br>    <span class="hljs-comment">//自定义状态码</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> code;<br>    <span class="hljs-comment">//自定义描述</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String message;<br><br>    ReturnCode(<span class="hljs-type">int</span> code, String message)&#123;<br>        <span class="hljs-built_in">this</span>.code = code;<br>        <span class="hljs-built_in">this</span>.message = message;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCode</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> code;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getMessage</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> message;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-3定义返回对象"><a href="#3-3定义返回对象" class="headerlink" title="3.3定义返回对象"></a>3.3定义返回对象</h3><p>一个标准的返回格式至少包含3部分：</p>
<ol>
<li>status 状态值：由后端统一定义各种返回结果的状态码。</li>
<li>message 描述：本次接口调用的结果描述。</li>
<li>data 数据：本次返回的数据。</li>
<li>timestamp: 接口调用时间(可以不要)</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;100&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;操作成功&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;hello&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>方式一：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep.vo;<br><br><span class="hljs-keyword">import</span> com.ep.utils.ReturnCode;<br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-comment">/***</span><br><span class="hljs-comment"> * 用于封装后端给前端返回的信息</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ResultInfo</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> status;           <span class="hljs-comment">//状态码</span><br><br>    <span class="hljs-keyword">private</span> String message;      <span class="hljs-comment">//错误信息</span><br><br>    <span class="hljs-keyword">private</span> Object data;         <span class="hljs-comment">//后端返回结果数据对象</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> timestamp ;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ResultInfo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.timestamp = System.currentTimeMillis();<br>    &#125;<br><br>    <span class="hljs-comment">/***</span><br><span class="hljs-comment">     * 成功，默认状态码为200</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> data 返回数据</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>  ResultInfo <span class="hljs-title function_">success</span><span class="hljs-params">(Object data)</span> &#123;<br>        <span class="hljs-type">ResultInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResultInfo</span>();<br>        info.setStatus(ReturnCode.S200.getCode());<br>        info.setMessage(ReturnCode.S200.getMessage());<br>        info.setData(data);<br>        <span class="hljs-keyword">return</span> info;<br>    &#125;<br>    <span class="hljs-comment">/***</span><br><span class="hljs-comment">     * 成功，可以自定义状态码和成功信息</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> code  状态码</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> message 自定义信息</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> data  数据</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ResultInfo <span class="hljs-title function_">success</span><span class="hljs-params">(<span class="hljs-type">int</span> code, String message, Object data)</span> &#123;<br>        <span class="hljs-type">ResultInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResultInfo</span>();<br>        info.setStatus(code);<br>        info.setMessage(message);<br>        info.setData(data);<br>        <span class="hljs-keyword">return</span> info;<br>    &#125;<br><br>    <span class="hljs-comment">/***</span><br><span class="hljs-comment">     * 失败</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> code  状态码</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> message  自定义信息</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ResultInfo <span class="hljs-title function_">fail</span><span class="hljs-params">(<span class="hljs-type">int</span> code, String message)</span> &#123;<br>        <span class="hljs-type">ResultInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResultInfo</span>();<br>        info.setStatus(code);<br>        info.setMessage(message);<br>        <span class="hljs-keyword">return</span> info;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>方式二：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep.vo;<br><br><span class="hljs-keyword">import</span> com.ep.utils.ReturnCode;<br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ResultData</span>&lt;T&gt; &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> status;           <span class="hljs-comment">//状态码</span><br><br>    <span class="hljs-keyword">private</span> String message;      <span class="hljs-comment">//错误信息</span><br><br>    <span class="hljs-keyword">private</span> T data;         <span class="hljs-comment">//后端返回结果数据对象</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> timestamp ;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ResultData</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.timestamp = System.currentTimeMillis();<br>    &#125;<br><br>    <span class="hljs-comment">/***</span><br><span class="hljs-comment">     * 成功，默认状态码为200</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> data 返回数据</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> &lt;T&gt;</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>  &lt;T&gt; ResultData&lt;T&gt; <span class="hljs-title function_">success</span><span class="hljs-params">(T data)</span> &#123;<br>        ResultData&lt;T&gt; resultData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResultData</span>&lt;&gt;();<br>        resultData.setStatus(ReturnCode.S200.getCode());<br>        resultData.setMessage(ReturnCode.S200.getMessage());<br>        resultData.setData(data);<br>        <span class="hljs-keyword">return</span> resultData;<br>    &#125;<br><br>    <span class="hljs-comment">/***</span><br><span class="hljs-comment">     * 成功，可以自定义状态码和成功信息</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> code  状态码</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> message 自定义信息</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> data  数据</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> &lt;T&gt;</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; ResultData&lt;T&gt; <span class="hljs-title function_">success</span><span class="hljs-params">(<span class="hljs-type">int</span> code, String message, T data)</span> &#123;<br>        ResultData&lt;T&gt; resultData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResultData</span>&lt;&gt;();<br>        resultData.setStatus(code);<br>        resultData.setMessage(message);<br>        resultData.setData(data);<br>        <span class="hljs-keyword">return</span> resultData;<br>    &#125;<br><br>    <span class="hljs-comment">/***</span><br><span class="hljs-comment">     * 失败</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> code  状态码</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> message  自定义信息</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> &lt;T&gt;</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; ResultData&lt;T&gt; <span class="hljs-title function_">fail</span><span class="hljs-params">(<span class="hljs-type">int</span> code, String message)</span> &#123;<br>        ResultData&lt;T&gt; info = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResultData</span>&lt;&gt;();<br>        info.setStatus(code);<br>        info.setMessage(message);<br>        <span class="hljs-keyword">return</span> info;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<blockquote>
<p>方式一和方式二的区别：</p>
<p>方式二可以指定返回数据的类型，而方式一默认是Object类型</p>
</blockquote>
<p>补充Object和泛型的区别</p>
<blockquote>
<p>Object范围非常广，而T从一开始就会限定这个类型（包括它可以限定类型为Object）。</p>
<p>Object由于它是所有类的父类，所以会强制类型转换，而T从一开始在编码时（注意是在写代码时）就限定了某种具体类型，所以它不用强制类型转换。</p>
</blockquote>
<h3 id="3-4编写测试接口"><a href="#3-4编写测试接口" class="headerlink" title="3.4编写测试接口"></a>3.4编写测试接口</h3><blockquote>
<p> 如果使用了jwt拦截器，记得排除拦截测试接口</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestController</span> &#123;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/test&quot;)</span><br>    <span class="hljs-keyword">public</span> ResultInfo <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> ResultInfo.success(<span class="hljs-literal">null</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/test1&quot;)</span><br>    <span class="hljs-keyword">public</span> ResultData&lt;String&gt; <span class="hljs-title function_">test1</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> ResultData.success(<span class="hljs-string">&quot;hello,success&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-5返回数据"><a href="#3-5返回数据" class="headerlink" title="3.5返回数据"></a>3.5返回数据</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">200</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;请求成功&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">null</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;timestamp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1658714057846</span><br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">200</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;请求成功&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hello,success&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;timestamp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1658714199127</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>这样确实已经实现了我们想要的结果，我在很多项目中看到的都是这种写法，在Controller层通过<code>ResultData.success()</code>对返回结果进行包装后返回给前端。</p>
<p>但是还是存在弊端，就是每写一个接口都要调用<code>ResultData.success()</code>，重复代码太多</p>
<h3 id="3-6ResponseBodyAdvice"><a href="#3-6ResponseBodyAdvice" class="headerlink" title="3.6ResponseBodyAdvice"></a>3.6ResponseBodyAdvice</h3><p><a href="#abnormal">快速使用直接点击跳转地址复制粘贴</a></p>
<blockquote>
<p>ResponseBodyAdvice的作用：拦截Controller方法的返回值，统一处理返回值&#x2F;响应体，一般用来统一返回格式，加解密，签名等等。</p>
</blockquote>
<h4 id="3-6-1ResponseBodyAdvice的源码："><a href="#3-6-1ResponseBodyAdvice的源码：" class="headerlink" title="3.6.1ResponseBodyAdvice的源码："></a>3.6.1<code>ResponseBodyAdvice</code>的源码：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ResponseBodyAdvice</span>&lt;T&gt; &#123;<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">  * 是否支持advice功能</span><br><span class="hljs-comment">  * true 支持，false 不支持</span><br><span class="hljs-comment">  */</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">supports</span><span class="hljs-params">(MethodParameter var1, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; var2)</span>;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">  * 对返回的数据进行处理</span><br><span class="hljs-comment">  */</span><br>    <span class="hljs-meta">@Nullable</span><br>    T <span class="hljs-title function_">beforeBodyWrite</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> T var1, MethodParameter var2, MediaType var3, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; var4, ServerHttpRequest var5, ServerHttpResponse var6)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="3-6-2编写接口实现类"><a href="#3-6-2编写接口实现类" class="headerlink" title="3.6.2编写接口实现类"></a>3.6.2编写接口实现类</h4><p>我们只需要编写实现类即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.ep.vo.ResultData;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;<br><span class="hljs-keyword">import</span> lombok.SneakyThrows;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.core.MethodParameter;<br><span class="hljs-keyword">import</span> org.springframework.http.MediaType;<br><span class="hljs-keyword">import</span> org.springframework.http.converter.HttpMessageConverter;<br><span class="hljs-keyword">import</span> org.springframework.http.server.ServerHttpRequest;<br><span class="hljs-keyword">import</span> org.springframework.http.server.ServerHttpResponse;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.ResponseBodyAdvice;<br><br><span class="hljs-meta">@RestControllerAdvice</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ResponseAdvice</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ResponseBodyAdvice</span>&lt;Object&gt; &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ObjectMapper objectMapper;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supports</span><span class="hljs-params">(MethodParameter methodParameter, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; aClass)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@SneakyThrows</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">beforeBodyWrite</span><span class="hljs-params">(Object o, MethodParameter methodParameter, MediaType mediaType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; aClass, ServerHttpRequest serverHttpRequest, ServerHttpResponse serverHttpResponse)</span> &#123;<br>        <span class="hljs-keyword">if</span>(o <span class="hljs-keyword">instanceof</span> String)&#123;<br>            <span class="hljs-keyword">return</span> objectMapper.writeValueAsString(ResultData.success(o));<br>        &#125;<br>        <span class="hljs-keyword">return</span> ResultData.success(o);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><code>@RestControllerAdvice</code>注解<br><code>@RestControllerAdvice</code>是<code>@RestController</code>注解的增强，可以实现三个方面的功能：</li>
</ul>
<ol>
<li>全局异常处理</li>
<li>全局数据绑定</li>
<li>全局数据预处理</li>
</ol>
<ul>
<li>String类型判断</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">if(o instanceof String)&#123;<br>  return objectMapper.writeValueAsString(ResultData.success(o));<br>&#125; <br></code></pre></td></tr></table></figure>

<p>这段代码一定要加，如果Controller直接返回String的话，SpringBoot是直接返回，故我们需要手动转换成json。</p>
<p>经过上面的处理我们就再也不需要通过<code>ResultData.success()</code>来进行转换了，直接返回原始数据格式，SpringBoot自动帮我们实现包装类的封装。</p>
<h4 id="3-6-3接口测试"><a href="#3-6-3接口测试" class="headerlink" title="3.6.3接口测试"></a>3.6.3接口测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/test1&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">test1</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello,ResponseAdvice&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>



<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">200</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;请求成功&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hello,ResponseAdvice&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;timestamp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1658715342475</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<h4 id="3-6-4接口异常问题"><a href="#3-6-4接口异常问题" class="headerlink" title="3.6.4接口异常问题"></a>3.6.4接口异常问题</h4><p>此时有个问题，由于我们没对Controller的异常进行处理，当我们调用的方法一旦出现异常，就会出现问题，比如下面这个接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/test1&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span> / <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">return</span> i;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>返回结果显然有问题</p>
<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220725101929123.png" srcset="/img/loading.gif" lazyload alt="image-20220725101929123"></p>
<p>​	请接着看下面的全局异常处理</p>
<h3 id="3-7全局异常处理"><a href="#3-7全局异常处理" class="headerlink" title="3.7全局异常处理"></a>3.7全局异常处理</h3><h4 id="3-7-1SpringBoot为什么需要全局异常处理器"><a href="#3-7-1SpringBoot为什么需要全局异常处理器" class="headerlink" title="3.7.1SpringBoot为什么需要全局异常处理器"></a>3.7.1SpringBoot为什么需要全局异常处理器</h4><ol>
<li>不用手写try…catch，由全局异常处理器统一捕获<br>使用全局异常处理器最大的便利就是程序员在写代码时不再需要手写<code>try...catch</code>了，前面我们讲过，默认情况下SpringBoot出现异常时返回的结果是这样：</li>
</ol>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs text">&#123;<br>  &quot;timestamp&quot;: &quot;2021-07-08T08:05:15.423+00:00&quot;,<br>  &quot;status&quot;: 500,<br>  &quot;error&quot;: &quot;Internal Server Error&quot;,<br>  &quot;path&quot;: &quot;/wrong&quot;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这种数据格式返回给前端，前端是看不懂的，所以这时候我们一般通过<code>try...catch</code>来处理异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/wrong&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">error</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">int</span> i;<br>    <span class="hljs-keyword">try</span>&#123;<br>        i = <span class="hljs-number">9</span>/<span class="hljs-number">0</span>;<br>    &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>        log.error(<span class="hljs-string">&quot;error:&#123;&#125;&quot;</span>,e);<br>        i = <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> i;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>我们追求的目标肯定是不需要再手动写<code>try...catch</code>了，而是希望由全局异常处理器处理。</p>
<ol>
<li>对于自定义异常，只能通过全局异常处理器来处理</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;error1&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">empty</span><span class="hljs-params">()</span>&#123;<br> <span class="hljs-keyword">throw</span>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;自定义异常&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<ol>
<li>当我们引入Validator参数校验器的时候，参数校验不通过会抛出异常，此时是无法用<code>try...catch</code>捕获的，只能使用全局异常处理器。</li>
</ol>
<h4 id="3-7-2如何实现全局异常处理器"><a href="#3-7-2如何实现全局异常处理器" class="headerlink" title="3.7.2如何实现全局异常处理器"></a>3.7.2如何实现全局异常处理器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestControllerAdvice</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RestExceptionHandler</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 默认全局异常处理。</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> e the e</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> ResultData</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@ExceptionHandler(Exception.class)</span><br>    <span class="hljs-meta">@ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)</span><br>    <span class="hljs-keyword">public</span> ResultData&lt;String&gt; <span class="hljs-title function_">exception</span><span class="hljs-params">(Exception e)</span> &#123;<br>        log.error(<span class="hljs-string">&quot;全局异常信息 ex=&#123;&#125;&quot;</span>, e.getMessage(), e);<br>        <span class="hljs-keyword">return</span> ResultData.fail(ReturnCode.RC500.getCode(),e.getMessage());<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<ol>
<li><code>@RestControllerAdvice</code>，RestController的增强类，可用于实现全局异常处理器</li>
<li><code>@ExceptionHandler</code>,统一处理某一类异常，从而减少代码重复率和复杂度，比如要获取自定义异常可以<code>@ExceptionHandler(BusinessException.class)</code></li>
<li><code>@ResponseStatus</code>指定客户端收到的http状态码</li>
</ol>
<h4 id="3-7-3全局异常接入返回的标准格式"><a href="#3-7-3全局异常接入返回的标准格式" class="headerlink" title="3.7.3全局异常接入返回的标准格式"></a>3.7.3<span id = "abnormal">全局异常接入返回的标准格式</span></h4><p>要让全局异常接入标准格式很简单，因为全局异常处理器已经帮我们封装好了标准格式，我们只需要直接返回给客户端即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.ep.vo.ResultData;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;<br><span class="hljs-keyword">import</span> lombok.SneakyThrows;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.core.MethodParameter;<br><span class="hljs-keyword">import</span> org.springframework.http.MediaType;<br><span class="hljs-keyword">import</span> org.springframework.http.converter.HttpMessageConverter;<br><span class="hljs-keyword">import</span> org.springframework.http.server.ServerHttpRequest;<br><span class="hljs-keyword">import</span> org.springframework.http.server.ServerHttpResponse;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.ResponseBodyAdvice;<br><br><span class="hljs-meta">@RestControllerAdvice</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ResponseAdvice</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ResponseBodyAdvice</span>&lt;Object&gt; &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ObjectMapper objectMapper;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supports</span><span class="hljs-params">(MethodParameter methodParameter, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; aClass)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@SneakyThrows</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">beforeBodyWrite</span><span class="hljs-params">(Object o, MethodParameter methodParameter, MediaType mediaType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; aClass, ServerHttpRequest serverHttpRequest, ServerHttpResponse serverHttpResponse)</span> &#123;<br>        <span class="hljs-keyword">if</span>(o <span class="hljs-keyword">instanceof</span> String)&#123;<br>            <span class="hljs-keyword">return</span> objectMapper.writeValueAsString(ResultData.success(o));<br>        &#125;<br>        <span class="hljs-keyword">if</span>(o <span class="hljs-keyword">instanceof</span> ResultData)&#123;<br>            <span class="hljs-keyword">return</span> o;<br>        &#125;<br>        <span class="hljs-keyword">return</span> ResultData.success(o);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>关键代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span>(o <span class="hljs-keyword">instanceof</span> ResultData)&#123;<br>  <span class="hljs-keyword">return</span> o;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>如果返回的结果是ResultData对象，直接返回即可。</p>
<p>这时候我们再调用上面的错误方法，返回的结果就符合我们的要求了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">&#123;<br>  <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-number">500</span>,<br>  <span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;自定义异常&quot;</span>,<br>  <span class="hljs-string">&quot;data&quot;</span>: <span class="hljs-literal">null</span>,<br>  <span class="hljs-string">&quot;timestamp&quot;</span>: <span class="hljs-number">1625796580778</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220725103305344.png" srcset="/img/loading.gif" lazyload alt="image-20220725103305344"></p>
<p>参考：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/391288136">https://zhuanlan.zhihu.com/p/391288136</a></p>
<h2 id="4-参数校验"><a href="#4-参数校验" class="headerlink" title="4.参数校验"></a>4.参数校验</h2><p>一个接口一般对参数（请求数据）都会进行安全校验，参数校验至关重要</p>
<p>首先我们来看一下最常见的做法，就是在业务层进行参数校验：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">addUser</span><span class="hljs-params">(User user)</span> &#123;<br>     <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span> || user.getId() == <span class="hljs-literal">null</span> || user.getAccount() == <span class="hljs-literal">null</span> || user.getPassword() == <span class="hljs-literal">null</span> || user.getEmail() == <span class="hljs-literal">null</span>) &#123;<br>         <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;对象或者对象字段不能为空&quot;</span>;<br>     &#125;<br>     <span class="hljs-keyword">if</span> (StringUtils.isEmpty(user.getAccount()) || StringUtils.isEmpty(user.getPassword()) || StringUtils.isEmpty(user.getEmail())) &#123;<br>         <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;不能输入空字符串&quot;</span>;<br>     &#125;<br>     <span class="hljs-keyword">if</span> (user.getAccount().length() &lt; <span class="hljs-number">6</span> || user.getAccount().length() &gt; <span class="hljs-number">11</span>) &#123;<br>         <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;账号长度必须是6-11个字符&quot;</span>;<br>     &#125;<br>     <span class="hljs-keyword">if</span> (user.getPassword().length() &lt; <span class="hljs-number">6</span> || user.getPassword().length() &gt; <span class="hljs-number">16</span>) &#123;<br>         <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;密码长度必须是6-16个字符&quot;</span>;<br>     &#125;<br>     <span class="hljs-comment">// 参数校验完毕后这里就写上业务逻辑</span><br>     <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span>;<br> &#125;<br></code></pre></td></tr></table></figure>

<p>虽然这样写是正确的但是太繁琐了。接下来使用Spring Validator和Hibernate Validator这两套Validator来进行方便的参数校验！这两套Validator依赖包已经包含在前面所说的web依赖包里了，所以可以直接使用。</p>
<p>本文使用的是2.7.1版本，需要导包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"> <span class="hljs-comment">&lt;!-- 数据校验 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="4-1Validator-BindResult进行校验"><a href="#4-1Validator-BindResult进行校验" class="headerlink" title="4.1Validator + BindResult进行校验"></a>4.1Validator + BindResult进行校验</h3><p>Validator可以非常方便的制定校验规则，并自动帮你完成校验。首先在入参里需要校验的字段加上注解,每个注解对应不同的校验规则，并可制定校验失败后的信息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-keyword">import</span> javax.validation.constraints.Email;<br><span class="hljs-keyword">import</span> javax.validation.constraints.NotBlank;<br><span class="hljs-keyword">import</span> javax.validation.constraints.NotNull;<br><span class="hljs-keyword">import</span> javax.validation.constraints.Size;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestValidator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-meta">@NotNull(message=&quot;用户id不能为空&quot;)</span><br>    <span class="hljs-keyword">private</span> Integer id;<br><br>    <span class="hljs-meta">@NotBlank(message = &quot;用户账号不能为空&quot;)</span><br>    <span class="hljs-meta">@Size(min = 6, max = 11, message = &quot;账号长度必须是6-11个字符&quot;)</span><br>    <span class="hljs-keyword">private</span> String username;<br><br>    <span class="hljs-meta">@NotBlank(message = &quot;用户密码不能为空&quot;)</span><br>    <span class="hljs-meta">@Size(min = 6,max = 18,message = &quot;密码长度必须为6-18个字符&quot;)</span><br>    <span class="hljs-keyword">private</span> String password;<br><br><br>    <span class="hljs-meta">@NotBlank(message = &quot;用户邮箱不能为空&quot;)</span><br>    <span class="hljs-meta">@Email(message = &quot;邮箱格式不正确&quot;)</span><br>    <span class="hljs-keyword">private</span> String email;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>校验规则和错误提示信息配置完毕后，接下来只需要在接口需要校验的参数上加上@Valid注解，并添加BindResult参数即可方便完成验证：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//注意需要给要校验的对象添加@Validated或者@valid</span><br><span class="hljs-meta">@PostMapping(&quot;/testvalidator&quot;)</span><br><span class="hljs-keyword">public</span> ResultData&lt;String&gt; <span class="hljs-title function_">testValidator</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> <span class="hljs-meta">@Valid</span> TestValidator user, BindingResult bindingResult)</span>&#123;<br><br>    <span class="hljs-comment">// 如果有参数校验失败，会将错误信息封装成对象组装在BindingResult里</span><br>    <span class="hljs-keyword">for</span> (ObjectError error : bindingResult.getAllErrors()) &#123;<br>        <span class="hljs-keyword">return</span> ResultData.fail(<span class="hljs-number">400</span>,error.getDefaultMessage());  <span class="hljs-comment">//这里建议用ResultData.fail方法</span><br>    &#125;<br>    <span class="hljs-comment">//验证成功，执行其他操作</span><br>    <span class="hljs-comment">//最后返回执行信息</span><br>    System.out.println(user);<br>    <span class="hljs-keyword">return</span> ResultData.success(<span class="hljs-string">&quot;校验成功&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220725144839291.png" srcset="/img/loading.gif" lazyload alt="image-20220725144839291" />

<blockquote>
<p>@Valid注解与@Validated注解功能差不多</p>
<p>不同点在于：</p>
<ul>
<li>@Valid属于javax包下，而@Validated属于Spring下</li>
<li>@Valid支持嵌套校验、而@Validated不支持</li>
<li>@Validated支持分组，而@Valid不支持</li>
</ul>
</blockquote>
<p>一般SpringBoot的项目会使用<strong>Spring Validation</strong>，它是对Hibernate Validation的二次封装。在SpringMVC模块中添加了自动校验。并将校验信息封装到特定的类中。</p>
<h3 id="4-2提供的校验注解"><a href="#4-2提供的校验注解" class="headerlink" title="4.2提供的校验注解"></a>4.2提供的校验注解</h3><ul>
<li><code>@Null</code> 被注释的元素必须为null</li>
<li><code>@NotNull </code>被注释的元素必须不为null, 不能为null，可以是空</li>
<li><code>@NotBlank(message =)</code> 验证字符串非 null，且长度必须大于 0,字符串trim()后也不能等于“”</li>
<li><code>@NotEmpty</code> 不能为null，集合、数组、map等size()不能为0；字符串trim()后可以等于“”</li>
<li><code>@AssertTrue</code> 被注释的元素必须为true</li>
<li><code>@AssertFalse </code>被注释的元素必须为false</li>
<li><code>@Min(value) </code>被注释的元素必须是一个数字，其值必须大于等于指定的最小值</li>
<li><code>@Max(value) </code>被注释的元素必须是一个数字，其值必须小于等于指定的最大值</li>
<li><code>@DecimalMin(value)</code> 被注释的元素必须是一个数字，其值必须大于等于指定的最小值</li>
<li><code>@DecimalMax(value) </code>被注释的元素必须是一个数字，其值必须小于等于指定的最大值</li>
<li><code>@Size(max, min) </code>被注释的元素的大小必须在指定的范围内</li>
<li><code>@Digits (integer, fraction)</code> 被注释的元素必须是一个数字，其值必须在可接受的范围内</li>
<li><code>@Past </code>被注释的元素必须是一个过去的日期</li>
<li><code>@Future </code>被注释的元素必须是一个将来的日期</li>
<li><code>@Pattern(value) </code>被注释的元素必须符合指定的正则表达式</li>
<li><code>@Email</code> 被注释的元素必须是电子邮箱地址</li>
<li><code>@Length(min=,max=)</code> 被注释的字符串的大小必须在指定的范围内</li>
<li><code>@Range(min=,max=,message=)</code> 被注释的元素必须在合适的范围内</li>
<li><code>@URL</code> 必须是一个URL</li>
</ul>
<h3 id="4-3Validator-自动抛出异常"><a href="#4-3Validator-自动抛出异常" class="headerlink" title="4.3Validator + 自动抛出异常"></a>4.3Validator + 自动抛出异常</h3><p>我们完全可以将BindingResult这一步给去掉：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//注意需要给要校验的对象添加@Validated或者@valid</span><br><span class="hljs-meta">@PostMapping(&quot;/testvalidator&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">testValidator</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> <span class="hljs-meta">@Valid</span> TestValidator user)</span>&#123;<br><br>    System.out.println(user);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;校验通过&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>其实这样就已经达到我们想要的效果了，参数校验不通过自然就不执行接下来的业务逻辑，去掉BindingResult后会自动引发异常，异常发生了自然而然就不会执行业务逻辑。也就是说，我们完全没必要添加相关BindingResult相关操作嘛。不过事情还没有完，异常是引发了，可我们并没有编写返回错误信息的代码呀，那参数校验失败了会响应什么数据给前端呢？ 我们来看一下刚才异常发生后接口响应的数据：</p>
<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220725140322724.png" srcset="/img/loading.gif" lazyload alt="image-20220725140322724"></p>
<p>参数校验失败会自动引发异常，我们当然不可能再去手动捕捉异常进行处理，不然还不如用之前BindingResult方式呢。<strong>又不想手动捕捉这个异常，又要对这个异常进行处理</strong>，那正好使用SpringBoot全局异常处理来达到一劳永逸的效果！</p>
<h4 id="4-3-1基本使用"><a href="#4-3-1基本使用" class="headerlink" title="4.3.1基本使用"></a>4.3.1基本使用</h4><p>首先，我们需要新建一个类，在这个类上加上<code>@ControllerAdvice</code>或<code>@RestControllerAdvice</code>注解，这个类就配置成全局处理类了。（这个根据你的Controller层用的是<code>@Controller</code>还是<code>@RestController</code>来决定） 然后在类中新建方法，在方法上加上<code>@ExceptionHandler</code>注解并指定你想处理的异常类型，接着在方法内编写对该异常的操作逻辑，就完成了对该异常的全局处理！ 我们现在就来演示一下对参数校验失败抛出的<code>MethodArgumentNotValidException</code>全局处理：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span><br><span class="hljs-keyword">public</span> ResultData&lt;String&gt; <span class="hljs-title function_">MethodArgumentNotValidExceptionHandler</span><span class="hljs-params">(MethodArgumentNotValidException e)</span> &#123;<br>    <span class="hljs-comment">// 从异常对象中拿到ObjectError对象</span><br>    <span class="hljs-type">ObjectError</span> <span class="hljs-variable">objectError</span> <span class="hljs-operator">=</span> e.getBindingResult().getAllErrors().get(<span class="hljs-number">0</span>);<br>    <span class="hljs-comment">// 然后提取错误提示信息进行返回</span><br>    <span class="hljs-keyword">return</span> ResultData.fail(<span class="hljs-number">400</span>,objectError.getDefaultMessage());<br>&#125;<br></code></pre></td></tr></table></figure>

<p>完整代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestControllerAdvice</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RestExceptionHandler</span> &#123;<br><br>    <span class="hljs-meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span><br>    <span class="hljs-keyword">public</span> ResultData&lt;String&gt; <span class="hljs-title function_">MethodArgumentNotValidExceptionHandler</span><span class="hljs-params">(MethodArgumentNotValidException e)</span> &#123;<br>        <span class="hljs-comment">// 从异常对象中拿到ObjectError对象</span><br>        <span class="hljs-type">ObjectError</span> <span class="hljs-variable">objectError</span> <span class="hljs-operator">=</span> e.getBindingResult().getAllErrors().get(<span class="hljs-number">0</span>);<br>        <span class="hljs-comment">// 然后提取错误提示信息进行返回</span><br>        <span class="hljs-keyword">return</span> ResultData.fail(<span class="hljs-number">400</span>,objectError.getDefaultMessage());<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 默认全局异常处理。</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> e the e</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> ResultData</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@ExceptionHandler(Exception.class)</span><br>    <span class="hljs-meta">@ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)</span><br>    <span class="hljs-keyword">public</span> ResultData&lt;String&gt; <span class="hljs-title function_">exception</span><span class="hljs-params">(Exception e)</span> &#123;<br>        log.error(<span class="hljs-string">&quot;全局异常信息 ex=&#123;&#125;&quot;</span>, e.getMessage(), e);<br>        <span class="hljs-keyword">return</span> ResultData.fail(ReturnCode.S500.getCode(),e.getMessage());<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220725143617801.png" srcset="/img/loading.gif" lazyload alt="image-20220725143617801"></p>
<h4 id="4-3-2自定义异常"><a href="#4-3-2自定义异常" class="headerlink" title="4.3.2自定义异常"></a>4.3.2自定义异常</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> lombok.Getter;<br><br><span class="hljs-meta">@Getter</span> <span class="hljs-comment">//只要getter方法，无需setter</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">APIException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RuntimeException</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> code;<br>    <span class="hljs-keyword">private</span> String msg;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">APIException</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>(<span class="hljs-number">400</span>, <span class="hljs-string">&quot;错误请求&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">APIException</span><span class="hljs-params">(String msg)</span> &#123;<br>        <span class="hljs-built_in">this</span>(<span class="hljs-number">400</span>, msg);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">APIException</span><span class="hljs-params">(<span class="hljs-type">int</span> code, String msg)</span> &#123;<br>        <span class="hljs-built_in">super</span>(msg);<br>        <span class="hljs-built_in">this</span>.code = code;<br>        <span class="hljs-built_in">this</span>.msg = msg;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这样就对异常的处理就比较规范了，当然还可以添加对<code>Exception</code>的处理，这样无论发生什么异常我们都能屏蔽掉然后响应数据给前端，不过建议最后项目上线时这样做，能够屏蔽掉错误信息暴露给前端，在开发中为了方便调试还是不要这样做。 </p>
<p>在刚才的全局异常处理类中记得添加对我们自定义异常的处理：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ExceptionHandler(APIException.class)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">APIExceptionHandler</span><span class="hljs-params">(APIException e)</span> &#123;<br>    <span class="hljs-keyword">return</span> e.getMsg();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>参考：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/340620501">https://zhuanlan.zhihu.com/p/340620501</a></p>
<h3 id="4-4分组校验"><a href="#4-4分组校验" class="headerlink" title="4.4分组校验"></a>4.4分组校验</h3><p>但是实际业务是在编辑的时候 <code>Id</code>才是必填，在新增的时候 <code>name</code>必填，这时候可以用groups分组功能来实现：同一个模型在不同场景下，动态区分校验模型中的不同字段。</p>
<h4 id="4-4-1使用方式"><a href="#4-4-1使用方式" class="headerlink" title="4.4.1使用方式"></a>4.4.1使用方式</h4><ol>
<li>首先我们定义一个分组接口ValidGroup，再在分组接口总定义出多个不同的操作类型，Create，Update，Query，Delete</li>
</ol>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ep.utils;<br><br><span class="hljs-keyword">import</span> javax.validation.groups.Default;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ValidGroup</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Default</span> &#123;<br>    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Crud</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ValidGroup</span>&#123;<br><br>        <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Create</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Crud</span>&#123;<br><br>        &#125;<br><br>        <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Update</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Crud</span>&#123;<br><br>        &#125;<br><br>        <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Query</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Crud</span>&#123;<br><br>        &#125;<br><br>        <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Delete</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Crud</span>&#123;<br><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>在模型中给校验参数分配分组</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.ep.utils.ValidGroup;<br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-keyword">import</span> javax.validation.constraints.Email;<br><span class="hljs-keyword">import</span> javax.validation.constraints.NotBlank;<br><span class="hljs-keyword">import</span> javax.validation.constraints.NotNull;<br><span class="hljs-keyword">import</span> javax.validation.constraints.Size;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestValidator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-meta">@NotNull(message=&quot;用户id不能为空&quot;)</span><br>    <span class="hljs-keyword">private</span> Integer id;<br><br>    <span class="hljs-meta">@NotBlank(message = &quot;用户账号不能为空&quot;,groups = ValidGroup.Crud.Update.class)</span><br>    <span class="hljs-meta">@Size(min = 6, max = 11, message = &quot;账号长度必须是6-11个字符&quot;)</span><br>    <span class="hljs-keyword">private</span> String username;<br><br>    <span class="hljs-meta">@NotBlank(groups = ValidGroup.Crud.Query.class)</span><br>    <span class="hljs-meta">@Size(min = 6,max = 18,message = &quot;密码长度必须为6-18个字符&quot;)</span><br>    <span class="hljs-keyword">private</span> String password;<br><br><br>    <span class="hljs-meta">@NotBlank(message = &quot;用户邮箱不能为空&quot;)</span><br>    <span class="hljs-meta">@Email(message = &quot;邮箱格式不正确&quot;)</span><br>    <span class="hljs-keyword">private</span> String email;<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>这里@Emailh和id注解未指定分组，默认会属于Default分组，username和password指定了分组就不会再属于Default分组了。</p>
</blockquote>
<p>3.在参数校验时通过value属性指定分组</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//注意需要给要校验的对象添加@Validated或者@valid</span><br><span class="hljs-meta">@PostMapping(&quot;/testvalidator&quot;)</span><br><span class="hljs-keyword">public</span> ResultData&lt;String&gt; <span class="hljs-title function_">testValidator</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> <span class="hljs-meta">@Validated(value = ValidGroup.Crud.Update.class)</span> TestValidator user)</span>&#123;<br><br>    <span class="hljs-keyword">return</span> ResultData.success(<span class="hljs-string">&quot;校验成功&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">//注意需要给要校验的对象添加@Validated或者@valid</span><br><span class="hljs-meta">@PostMapping(&quot;/testvalidator&quot;)</span><br><span class="hljs-keyword">public</span> ResultData&lt;String&gt; <span class="hljs-title function_">testValidator</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> <span class="hljs-meta">@Validated(&#123;ValidGroup.Crud.Update.class,ValidGroup.Crud.Create.class&#125;)</span> TestValidator user)</span>&#123;<br><br>    <span class="hljs-keyword">return</span> ResultData.success(<span class="hljs-string">&quot;校验成功&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这里通过 <code>@Validated(value = ValidGroup.Crud.Update.class)</code>指定了具体的分组，上面提到的是否继承Default的区别在于：</p>
<ul>
<li>如果继承了Default，@Validated标注的注解也会校验未指定分组或者Default分组的参数，比如email</li>
<li>如果不继承Default则不会校验未指定分组的参数，需要加上<code>@Validated(value = &#123;ValidGroup.Crud.Update.class, Default.class&#125;</code>才会校验</li>
</ul>
<h3 id="4-5快速失败（Fali-Fast）"><a href="#4-5快速失败（Fali-Fast）" class="headerlink" title="4.5快速失败（Fali Fast）"></a>4.5快速失败（Fali Fast）</h3><p>默认情况下在对参数进行校验时Spring Validation会校验完所有字段然后才抛出异常，可以通过配置开启 <code>Fali Fast</code>模式，一旦校验失败就立即返回。</p>
<p>config&#x2F;ValidatedConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.hibernate.validator.HibernateValidator;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><br><span class="hljs-keyword">import</span> javax.validation.Validation;<br><span class="hljs-keyword">import</span> javax.validation.Validator;<br><span class="hljs-keyword">import</span> javax.validation.ValidatorFactory;<br><br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ValidatedConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Validator <span class="hljs-title function_">validator</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">ValidatorFactory</span> <span class="hljs-variable">validatorFactory</span> <span class="hljs-operator">=</span> Validation.byProvider(HibernateValidator.class)<br>                .configure()<br>                <span class="hljs-comment">// 快速失败模式</span><br>                .failFast(<span class="hljs-literal">true</span>)<br>                .buildValidatorFactory();<br>        <span class="hljs-keyword">return</span> validatorFactory.getValidator();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-6嵌套校验"><a href="#4-6嵌套校验" class="headerlink" title="4.6嵌套校验"></a>4.6嵌套校验</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-keyword">import</span> javax.validation.constraints.Email;<br><span class="hljs-keyword">import</span> javax.validation.constraints.NotBlank;<br><span class="hljs-keyword">import</span> javax.validation.constraints.Size;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestDemo</span> &#123;<br>    <span class="hljs-meta">@NotNull(message = &quot;id必须非空&quot;)</span><br>    <span class="hljs-keyword">private</span> Long id;<br><br>    <span class="hljs-meta">@NotBlank(message = &quot;用户名不能为空,并且长度必须大于0&quot;)</span><br>    <span class="hljs-meta">@Size(min = 6, max = 11, message = &quot;用户名长度必须是6-11个字符&quot;)</span><br>    <span class="hljs-keyword">private</span> String username;<br><br>    <span class="hljs-meta">@NotBlank(message = &quot;用户密码不能为空,并且长度必须大于0&quot;)</span><br>    <span class="hljs-meta">@Size(min = 6, max = 16, message = &quot;密码长度必须是6-16个字符&quot;)</span><br>    <span class="hljs-keyword">private</span> String password;<br><br>    <span class="hljs-meta">@Email(message = &quot;邮箱格式错误&quot;)</span><br>    <span class="hljs-meta">@NotBlank(message = &quot;邮箱不能为空,并且长度必须大于0&quot;)</span><br>    <span class="hljs-keyword">private</span> String email;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 嵌套校验需要加<span class="hljs-doctag">@Valid</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Valid</span><br>    <span class="hljs-meta">@NotNull</span><br>    <span class="hljs-keyword">private</span> Test02 test02;<br>    <br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-keyword">import</span> javax.validation.constraints.NotNull;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test02</span> &#123;<br><br>    <span class="hljs-meta">@NotNull(message = &quot;id必须非空&quot;)</span><br>    <span class="hljs-keyword">private</span> Long id;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-7自定义校验注解"><a href="#4-7自定义校验注解" class="headerlink" title="4.7自定义校验注解"></a>4.7自定义校验注解</h3><h4 id="4-7-1编写自定义注解"><a href="#4-7-1编写自定义注解" class="headerlink" title="4.7.1编写自定义注解"></a>4.7.1编写自定义注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> javax.validation.Constraint;<br><span class="hljs-keyword">import</span> javax.validation.Payload;<br><span class="hljs-keyword">import</span> java.lang.annotation.*;<br><br><span class="hljs-meta">@Target(&#123;ElementType.METHOD, ElementType.FIELD, ElementType.ANNOTATION_TYPE, ElementType.CONSTRUCTOR, ElementType.PARAMETER, ElementType.TYPE_USE&#125;)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-meta">@Constraint(</span><br><span class="hljs-meta">        validatedBy = PhoneValidator.class</span><br><span class="hljs-meta">)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Phone &#123;<br>    String <span class="hljs-title function_">message</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;手机格式不正确!&quot;</span>;<br><br>    Class&lt;?&gt;[] groups() <span class="hljs-keyword">default</span> &#123;&#125;;<br><br>    Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Payload</span>&gt;[] payload() <span class="hljs-keyword">default</span> &#123;&#125;;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="4-7-2编写该注解校验器"><a href="#4-7-2编写该注解校验器" class="headerlink" title="4.7.2编写该注解校验器"></a>4.7.2编写该注解校验器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> javax.validation.ConstraintValidator;<br><span class="hljs-keyword">import</span> javax.validation.ConstraintValidatorContext;<br><span class="hljs-keyword">import</span> java.util.regex.Matcher;<br><span class="hljs-keyword">import</span> java.util.regex.Pattern;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PhoneValidator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ConstraintValidator</span>&lt;Phone, String&gt; &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isValid</span><span class="hljs-params">(String phoneNum, ConstraintValidatorContext constraintValidatorContext)</span> &#123;<br>        <span class="hljs-comment">// 1: 如果用户没输入直接返回不校验，因为空的判断交给@NotNull去做就行了</span><br>        <span class="hljs-keyword">if</span> (phoneNum == <span class="hljs-literal">null</span> &amp;&amp; phoneNum.length() == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-type">Pattern</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> Pattern.compile(<span class="hljs-string">&quot;^(13[0-9]|14[5|7|9]|15[0|1|2|3|5|6|7|8|9]|17[0|1|6|7|8]|18[0-9])\\d&#123;8&#125;$&quot;</span>);<br>        <span class="hljs-comment">// 2：如果校验通过就返回true,否则返回false;</span><br>        <span class="hljs-type">Matcher</span> <span class="hljs-variable">matcher</span> <span class="hljs-operator">=</span> p.matcher(phoneNum);<br>        <span class="hljs-keyword">return</span> matcher.matches();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="4-7-3使用"><a href="#4-7-3使用" class="headerlink" title="4.7.3使用"></a>4.7.3使用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.ep.utils.Phone;<br><span class="hljs-keyword">import</span> com.ep.utils.ValidGroup;<br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-keyword">import</span> javax.validation.constraints.Email;<br><span class="hljs-keyword">import</span> javax.validation.constraints.NotBlank;<br><span class="hljs-keyword">import</span> javax.validation.constraints.NotNull;<br><span class="hljs-keyword">import</span> javax.validation.constraints.Size;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestValidator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-meta">@NotNull(message=&quot;用户id不能为空&quot;)</span><br>    <span class="hljs-keyword">private</span> Integer id;<br><br>    <span class="hljs-meta">@NotBlank(message = &quot;用户账号不能为空&quot;,groups = ValidGroup.Crud.Update.class)</span><br>    <span class="hljs-meta">@Size(min = 6, max = 11, message = &quot;账号长度必须是6-11个字符&quot;)</span><br>    <span class="hljs-keyword">private</span> String username;<br><br>    <span class="hljs-meta">@Phone(message = &quot;手机号码不合法&quot;)</span><br>    <span class="hljs-keyword">private</span> String phone;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220725163359193.png" srcset="/img/loading.gif" lazyload alt="image-20220725163359193"></p>
<h2 id="5-日志"><a href="#5-日志" class="headerlink" title="5.日志"></a>5.日志</h2><p><a href="#logging">点击直接跳转使用</a></p>
<h3 id="5-1日志框架"><a href="#5-1日志框架" class="headerlink" title="5.1日志框架"></a>5.1日志框架</h3><p> 小张；开发一个大型系统；</p>
<p>​		1、System.out.println(“”)；将关键数据打印在控制台；去掉？写在一个文件？</p>
<p>​		2、框架来记录系统的一些运行时信息；日志框架 ；  zhanglogging.jar；</p>
<p>​		3、高大上的几个功能？异步模式？自动归档？xxxx？  zhanglogging-good.jar？</p>
<p>​		4、将以前框架卸下来？换上新的框架，重新修改之前相关的API；zhanglogging-prefect.jar；</p>
<p>​		5、JDBC—数据库驱动；</p>
<p>​			写了一个统一的接口层；日志门面（日志的一个抽象层）；logging-abstract.jar；</p>
<p>​			给项目中导入具体的日志实现就行了；我们之前的日志框架都是实现的抽象层；</p>
<p><strong>市面上的日志框架；</strong></p>
<p>JUL、JCL、Jboss-logging、logback、log4j、log4j2、slf4j….</p>
<table>
<thead>
<tr>
<th>日志门面  （日志的抽象层）</th>
<th>日志实现</th>
</tr>
</thead>
<tbody><tr>
<td><del>JCL（Jakarta  Commons Logging）</del>    SLF4j（Simple  Logging Facade for Java）    <strong><del>jboss-logging</del></strong></td>
<td>Log4j  JUL（java.util.logging）  Log4j2  <strong>Logback</strong></td>
</tr>
</tbody></table>
<p>左边选一个门面（抽象层）、右边来选一个实现；</p>
<p>日志门面：  SLF4J；</p>
<p>日志实现：Logback；</p>
<p>SpringBoot：底层是Spring框架，Spring框架默认是用JCL；‘</p>
<p>​	<strong>&#x3D;&#x3D;SpringBoot选用 SLF4j和logback；&#x3D;&#x3D;</strong></p>
<h3 id="5-2-SLF4j使用"><a href="#5-2-SLF4j使用" class="headerlink" title="5.2 SLF4j使用"></a>5.2 SLF4j使用</h3><h4 id="5-2-1如何在系统中使用SLF4j-https-www-slf4j-org"><a href="#5-2-1如何在系统中使用SLF4j-https-www-slf4j-org" class="headerlink" title="5.2.1如何在系统中使用SLF4j   https://www.slf4j.org"></a>5.2.1如何在系统中使用SLF4j   <a target="_blank" rel="noopener" href="https://www.slf4j.org/">https://www.slf4j.org</a></h4><p>以后开发的时候，日志记录方法的调用，不应该来直接调用日志的实现类，而是调用日志抽象层里面的方法；</p>
<p>给系统里面导入slf4j的jar和  logback的实现jar</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.slf4j.Logger;<br><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloWorld</span> &#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(HelloWorld.class);<br>    logger.info(<span class="hljs-string">&quot;Hello World&quot;</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>图示；</p>
<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220804100940418.png" srcset="/img/loading.gif" lazyload alt="image-20220804100940418"></p>
<p>每一个日志的实现框架都有自己的配置文件。使用slf4j以后，<strong>配置文件还是做成日志实现框架自己本身的配置文件；</strong></p>
<h4 id="5-2-2遗留问题"><a href="#5-2-2遗留问题" class="headerlink" title="5.2.2遗留问题"></a>5.2.2遗留问题</h4><p>a（slf4j+logback）: Spring（commons-logging）、Hibernate（jboss-logging）、MyBatis、xxxx</p>
<p>统一日志记录，即使是别的框架和我一起统一使用slf4j进行输出？</p>
<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/legacy.png" srcset="/img/loading.gif" lazyload></p>
<p><strong>如何让系统中所有的日志都统一到slf4j；</strong></p>
<p>&#x3D;&#x3D;1、将系统中其他日志框架先排除出去；&#x3D;&#x3D;</p>
<p>&#x3D;&#x3D;2、用中间包来替换原有的日志框架；&#x3D;&#x3D;</p>
<p>&#x3D;&#x3D;3、我们导入slf4j其他的实现&#x3D;&#x3D;</p>
<h3 id="5-3-SpringBoot日志关系"><a href="#5-3-SpringBoot日志关系" class="headerlink" title="5.3.SpringBoot日志关系"></a>5.3.SpringBoot日志关系</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>SpringBoot使用它来做日志功能；</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>底层依赖关系</p>
<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180131220946.png" srcset="/img/loading.gif" lazyload></p>
<p>总结：</p>
<p>​	1）、SpringBoot底层也是使用slf4j+logback的方式进行日志记录</p>
<p>​	2）、SpringBoot也把其他的日志都替换成了slf4j；</p>
<p>​	3）、中间替换包？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SuppressWarnings(&quot;rawtypes&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogFactory</span> &#123;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">UNSUPPORTED_OPERATION_IN_JCL_OVER_SLF4J</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;http://www.slf4j.org/codes.html#unsupported_operation_in_jcl_over_slf4j&quot;</span>;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">LogFactory</span> <span class="hljs-variable">logFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SLF4JLogFactory</span>();<br></code></pre></td></tr></table></figure>

<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180131221411.png" srcset="/img/loading.gif" lazyload></p>
<p>​	4）、如果我们要引入其他框架？一定要把这个框架的默认日志依赖移除掉？</p>
<p>​			Spring框架用的是commons-logging；</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>			<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-logging<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>			<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>		<span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>	<span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p><strong>&#x3D;&#x3D;SpringBoot能自动适配所有的日志，而且底层使用slf4j+logback的方式记录日志，引入其他框架的时候，只需要把这个框架依赖的日志框架排除掉即可；&#x3D;&#x3D;</strong></p>
<h3 id="5-4日志使用；"><a href="#5-4日志使用；" class="headerlink" title="5.4日志使用；"></a><span id="logging">5.4日志使用；</span></h3><h4 id="5-4-1默认配置"><a href="#5-4-1默认配置" class="headerlink" title="5.4.1默认配置"></a>5.4.1默认配置</h4><p>SpringBoot默认帮我们配置好了日志；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<br><span class="hljs-keyword">import</span> org.slf4j.Logger;<br><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<br><span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;<br><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringbootLoggingApplicationTests</span> &#123;<br>    <span class="hljs-comment">//记录器</span><br>    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(getClass());<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoads</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//日志的级别；</span><br>        <span class="hljs-comment">//由低到高   trace&lt;debug&lt;info&lt;warn&lt;error</span><br>        <span class="hljs-comment">//可以调整输出的日志级别；日志就只会在这个级别以以后的高级别生效# 配置日志的级别logging.level.com.ep = trace</span><br>        logger.trace(<span class="hljs-string">&quot;trace日志...&quot;</span>);<br>        logger.debug(<span class="hljs-string">&quot;debug日志...&quot;</span>);<br>        <span class="hljs-comment">//SpringBoot默认给我们使用的是info级别的，没有指定级别的就用SpringBoot默认规定的级别；root级别</span><br>        logger.info(<span class="hljs-string">&quot;info日志...&quot;</span>);<br>        logger.warn(<span class="hljs-string">&quot;warn日志...&quot;</span>);<br>        logger.error(<span class="hljs-string">&quot;error日志...&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>不指定路径在当前项目文件夹下生成log文件</p>
<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220804103900562.png" srcset="/img/loading.gif" lazyload alt="image-20220804103900562"></p>
<blockquote>
<p>1、<code>logging.file.name</code> 设置具体输出的日志名称，可以是绝对路径或者基于当前运行目录的相对路径，例如：<code>logging.file.name=app.log、logging.file.name=/var/log/hello-service/app.log</code></p>
<p>2、<code>logging.file.path</code> 设置输出的日志被写入到的目录，默认文件名为<code> spring.log</code>，例如：<code>logging.file.path=D:/log</code></p>
<p>3、如果你两个都同时设置，则以 <code>logging.file.name </code>为准。</p>
<p>本文重点，是推荐使用 logging.file.name，原因是因为这里涉及到另外一个知识点，那就是 spring 的 actuator 中的 logfile 接口（例如：<a target="_blank" rel="noopener" href="http://localhost:8080/hello-service/actuator/logfile">http://localhost:8080/hello-service/actuator/logfile</a> 可以直接获取日志文件，比较不错的是它还支持使用 HTTPRange 头来检索日志文件的部分内容）。</p>
<p>如果你只设置了 logging.file.name，不论你实际的文件名设置为什么，这个接口都可以正常获取日志文件（因为接口它能明确知道日志文件的位置路径）。</p>
<p>如果你只设置了 logging.file.path，并且没有在自定义的 logback.xml 文件重新定义输出的具体日志文件的名称（也就是仍然使用默认的spring.log），那么 logfile 接口也是能正常获取日志文件，因为它是按照默认文件 spring.log 获取日志的。但是但凡你在 logback.xml 中重新定义了输出的日志文件名（例如输出的日志文件为 hello-service.log），则你使用 actuator&#x2F;logfile 接口就会或得一个404，因为此时框架并不知道你的真实日志文件叫什么，它去读取 spring.log 又读不到（因为你改名了）。</p>
<p>so，建议<strong>直接使用 logging.file.name</strong>，清晰明了。</p>
</blockquote>
<pre><code class="hljs">    日志输出格式：
        %d表示日期时间，
        %thread表示线程名，
        %-5level：级别从左显示5个字符宽度
        %logger&#123;50&#125; 表示logger名字最长50个字符，否则按照句点分割。 
        %msg：日志消息，
        %n是换行符
    --&gt;
    %d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n
</code></pre>
<p><strong>SpringBoot修改日志的默认配置</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># 配置日志的级别</span><br><span class="hljs-attr">logging.level.com.ep</span> = <span class="hljs-string">trace</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 设置输出的日志被写入到的目录，默认文件名为spring.log</span><br><span class="hljs-comment"># logging.file.path = D:/log</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 在当前磁盘的根路径下创建spring文件夹和里面的log文件夹；使用spring.log作为默认文件</span><br><span class="hljs-comment"># logging.file.path = /spring/log</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 生成的日志文件在当前目录下，指定输出的文件名</span><br><span class="hljs-attr">logging.file.name</span> = <span class="hljs-string">springboot.log</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 可以指定文件的输出目录和文件名，可以是相对路径也可以是绝对路径</span><br><span class="hljs-comment"># logging.file.name = D:/log/springboot.log</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">#  在控制台输出的日志的格式</span><br><span class="hljs-attr">logging.pattern.console</span>=<span class="hljs-string">%d&#123;yyyy-MM-dd&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n</span><br><span class="hljs-comment"># 指定文件中日志输出的格式</span><br><span class="hljs-attr">logging.pattern.file</span>=<span class="hljs-string">%d&#123;yyyy-MM-dd&#125; === [%thread] === %-5level === %logger&#123;50&#125; ==== %msg%n</span><br></code></pre></td></tr></table></figure>

<h4 id="5-4-2指定配置"><a href="#5-4-2指定配置" class="headerlink" title="5.4.2指定配置"></a>5.4.2指定配置</h4><p>给类路径下放上每个日志框架自己的配置文件即可；SpringBoot就不使用他默认配置的了</p>
<table>
<thead>
<tr>
<th>Logging System</th>
<th>Customization</th>
</tr>
</thead>
<tbody><tr>
<td>Logback</td>
<td><code>logback-spring.xml</code>, <code>logback-spring.groovy</code>, <code>logback.xml</code> or <code>logback.groovy</code></td>
</tr>
<tr>
<td>Log4j2</td>
<td><code>log4j2-spring.xml</code> or <code>log4j2.xml</code></td>
</tr>
<tr>
<td>JDK (Java Util Logging)</td>
<td><code>logging.properties</code></td>
</tr>
</tbody></table>
<p>logback.xml：直接就被日志框架识别了；</p>
<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220804111738828.png" srcset="/img/loading.gif" lazyload alt="image-20220804111738828"></p>
<p><strong>logback-spring.xml</strong>：日志框架就不直接加载日志的配置项，由SpringBoot解析日志配置，可以使用SpringBoot的高级Profile功能</p>
<p>application.properties中配置环境</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">spring.profiles.active</span>=<span class="hljs-string">dev</span><br></code></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">springProfile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;staging&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- configuration to be enabled when the &quot;staging&quot; profile is active --&gt;</span><br>  	可以指定某段配置只在某个环境下生效<br><span class="hljs-tag">&lt;/<span class="hljs-name">springProfile</span>&gt;</span><br><br></code></pre></td></tr></table></figure>

<p>如：（<strong>logback-spring.xml</strong>中的代码加上springrofile相关。如果是logback.xml则需要去掉，只留pattern就可以了）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;stdout&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">        日志输出格式：</span><br><span class="hljs-comment">			%d表示日期时间，</span><br><span class="hljs-comment">			%thread表示线程名，</span><br><span class="hljs-comment">			%-5level：级别从左显示5个字符宽度</span><br><span class="hljs-comment">			%logger&#123;50&#125; 表示logger名字最长50个字符，否则按照句点分割。 </span><br><span class="hljs-comment">			%msg：日志消息，</span><br><span class="hljs-comment">			%n是换行符</span><br><span class="hljs-comment">        --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">layout</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.PatternLayout&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">springProfile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dev&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; ----&gt; [%thread] ---&gt; %-5level %logger&#123;50&#125; - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">springProfile</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">springProfile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;!dev&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; ==== [%thread] ==== %-5level %logger&#123;50&#125; - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">springProfile</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p><img src="https://trpora-1300527744.cos.ap-chongqing.myqcloud.com/img/image-20220804150445658.png" srcset="/img/loading.gif" lazyload alt="image-20220804150445658"></p>
<p>如果使用logback.xml作为日志配置文件，还要使用profile功能，会有以下错误</p>
<p> <code>no applicable action for [springProfile]</code></p>
<h3 id="5-5切换日志框架"><a href="#5-5切换日志框架" class="headerlink" title="5.5切换日志框架"></a>5.5切换日志框架</h3><p>可以按照slf4j的日志适配图，进行相关的切换；</p>
<p>slf4j+log4j的方式；</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>logback-classic<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>ch.qos.logback<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j-over-slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-log4j12<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br></code></pre></td></tr></table></figure>

<p>切换为log4j2</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml">   <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<hr>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/SpringBoot/">#SpringBoot</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>SpringBoot</div>
      <div>http://example.com/2022/08/06/SpringBoot/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Deng ErPu</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年8月6日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/08/08/Swagger/" title="Swagger">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Swagger</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/08/04/Typora%E5%9B%BE%E7%89%87%E6%B0%B8%E4%B9%85%E4%BF%9D%E5%AD%98/" title="Typora图片永久保存">
                        <span class="hidden-mobile">Typora图片永久保存</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
